<!DOCTYPE html><html lang="ru"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>üéÆ GameZone - –ò–≥—Ä–æ–≤–æ–π –ü–æ—Ä—Ç–∞–ª</title>    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">    <style>        * { font-family: 'Nunito', sans-serif; }                body {            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);            min-height: 100vh;        }                .glass {            background: rgba(255, 255, 255, 0.1);            backdrop-filter: blur(20px);            border: 1px solid rgba(255, 255, 255, 0.2);        }                .neon-glow {            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5), 0 0 40px rgba(139, 92, 246, 0.3);        }                .game-card {            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);        }                .game-card:hover {            transform: translateY(-10px) scale(1.02);            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.4);        }                .floating {            animation: floating 3s ease-in-out infinite;        }                @keyframes floating {            0%, 100% { transform: translateY(0); }            50% { transform: translateY(-10px); }        }                .pulse-glow {            animation: pulseGlow 2s ease-in-out infinite;        }                @keyframes pulseGlow {            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.8), 0 0 60px rgba(236, 72, 153, 0.4); }        }                .gradient-text {            background: linear-gradient(135deg, #8b5cf6, #ec4899, #06b6d4);            -webkit-background-clip: text;            -webkit-text-fill-color: transparent;            background-clip: text;        }                .btn-primary {            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);            transition: all 0.3s ease;        }                .btn-primary:hover {            transform: scale(1.05);            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);        }                .online-dot {            animation: onlinePulse 2s infinite;        }                @keyframes onlinePulse {            0%, 100% { opacity: 1; }            50% { opacity: 0.5; }        }                .particle {            position: fixed;            pointer-events: none;            border-radius: 50%;            animation: floatUp 15s linear infinite;        }                @keyframes floatUp {            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }            10% { opacity: 1; }            90% { opacity: 1; }            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }        }                .rainbow-border {            background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);            background-size: 400%;            animation: rainbowMove 3s linear infinite;            padding: 3px;        }                @keyframes rainbowMove {            0% { background-position: 0% 50%; }            100% { background-position: 400% 50%; }        }                .gold-glow {            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), 0 0 60px rgba(255, 215, 0, 0.3);            animation: goldPulse 1.5s ease-in-out infinite;        }                @keyframes goldPulse {            0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }            50% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.9), 0 0 80px rgba(255, 215, 0, 0.4); }        }                .police-glow {            box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);        }                .robber-glow {            box-shadow: 0 0 20px rgba(239, 68, 68, 0.8);        }        .slide-in {            animation: slideIn 0.5s ease-out;        }        @keyframes slideIn {            from { opacity: 0; transform: translateY(20px); }            to { opacity: 1; transform: translateY(0); }        }                .game-arena {            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);            position: relative;            touch-action: none;        }                .ship-cell {            transition: all 0.2s;        }                .ship-cell:hover {            background: rgba(59, 130, 246, 0.5);        }                .explosion {            animation: explode 0.5s ease-out forwards;        }                @keyframes explode {            0% { transform: scale(0); opacity: 1; }            100% { transform: scale(2); opacity: 0; }        }        ::-webkit-scrollbar { width: 8px; }        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }        ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #8b5cf6, #ec4899); border-radius: 4px; }    </style></head><body class="text-white overflow-x-hidden">    <!-- Particles Background -->    <div id="particles"></div>    <!-- Auth Screen -->    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">        <div class="glass rounded-3xl p-8 w-full max-w-md neon-glow slide-in">            <div class="text-center mb-8">                <h1 class="text-5xl font-black gradient-text mb-2">üéÆ GameZone</h1>                <p class="text-gray-300">–ò–≥—Ä–∞–π —Å –¥—Ä—É–∑—å—è–º–∏ –æ–Ω–ª–∞–π–Ω!</p>            </div>                        <div id="authTabs" class="flex mb-6 bg-white/10 rounded-xl p-1">                <button onclick="showAuthTab('login')" id="loginTab" class="flex-1 py-2 rounded-lg bg-purple-500 font-bold transition-all">–í—Ö–æ–¥</button>                <button onclick="showAuthTab('register')" id="registerTab" class="flex-1 py-2 rounded-lg font-bold transition-all">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>            </div>                        <div id="loginForm">                <input type="email" id="loginEmail" placeholder="Email" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <button onclick="login()" class="w-full btn-primary py-4 rounded-xl font-bold text-lg">–í–æ–π—Ç–∏ üöÄ</button>            </div>                        <div id="registerForm" class="hidden">                <input type="text" id="regUsername" placeholder="–ù–∏–∫–Ω–µ–π–º" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <input type="email" id="regEmail" placeholder="Email" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <button onclick="register()" class="w-full btn-primary py-4 rounded-xl font-bold text-lg">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç ‚ú®</button>            </div>                        <p id="authError" class="text-red-400 text-center mt-4 hidden"></p>        </div>    </div>    <!-- Main App -->    <div id="mainApp" class="hidden">        <!-- Header -->        <header class="glass sticky top-0 z-50 px-6 py-4">            <div class="max-w-7xl mx-auto flex items-center justify-between">                <h1 class="text-2xl font-black gradient-text">üéÆ GameZone</h1>                <div class="flex items-center gap-4">                    <div class="flex items-center gap-2">                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center font-bold" id="userAvatar">?</div>                        <span id="userName" class="font-bold hidden sm:block">–ò–≥—Ä–æ–∫</span>                    </div>                    <button onclick="logout()" class="glass px-4 py-2 rounded-xl hover:bg-white/20 transition-all">üö™</button>                </div>            </div>        </header>        <!-- Navigation -->        <nav class="flex justify-center gap-2 p-4 flex-wrap">            <button onclick="showSection('games')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all" data-section="games">üéÆ –ò–≥—Ä—ã</button>            <button onclick="showSection('friends')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all" data-section="friends">üë• –î—Ä—É–∑—å—è</button>            <button onclick="showSection('leaderboard')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all" data-section="leaderboard">üèÜ –†–µ–π—Ç–∏–Ω–≥</button>            <button onclick="showSection('invites')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all relative" data-section="invites">                üì® –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è                <span id="invitesBadge" class="absolute -top-2 -right-2 bg-red-500 text-xs w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>            </button>        </nav>        <!-- Games Section -->        <section id="gamesSection" class="max-w-7xl mx-auto p-6">            <h2 class="text-3xl font-black mb-6 gradient-text">üéÆ –í—ã–±–µ—Ä–∏ –∏–≥—Ä—É</h2>                        <!-- Featured Games -->            <h3 class="text-xl font-bold mb-4 text-yellow-300">‚≠ê –¢–æ–ø –∏–≥—Ä—ã</h3>            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">                <!-- Bank Heist -->                <div class="rainbow-border rounded-2xl cursor-pointer" onclick="openGame('heist')">                    <div class="game-card bg-gray-900 rounded-2xl p-6 h-full">                        <div class="text-6xl mb-4 floating">üè¶üí∞</div>                        <h3 class="text-2xl font-bold mb-2">–û–≥—Ä–∞–±–ª–µ–Ω–∏–µ –ë–∞–Ω–∫–∞</h3>                        <p class="text-gray-300 mb-4">–ì—Ä–∞–±–∏—Ç–µ–ª—å vs –ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π!</p>                        <span class="inline-block bg-red-500/30 text-red-300 px-3 py-1 rounded-full text-sm">üî• –ù–û–í–ò–ù–ö–ê</span>                    </div>                </div>                                <!-- Sea Battle -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer gold-glow" onclick="openGame('seabattle')">                    <div class="text-6xl mb-4 floating">üö¢üí•</div>                    <h3 class="text-2xl font-bold mb-2">–ú–æ—Ä—Å–∫–æ–π –ë–æ–π</h3>                    <p class="text-gray-300 mb-4">–ü–æ—Ç–æ–ø–∏ —Ñ–ª–æ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞!</p>                    <span class="inline-block bg-blue-500/30 text-blue-300 px-3 py-1 rounded-full text-sm">üë• –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</span>                </div>                                <!-- Tank Battle -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('tanks')">                    <div class="text-6xl mb-4 floating">üî´üéØ</div>                    <h3 class="text-2xl font-bold mb-2">–¢–∞–Ω–∫–æ–≤—ã–π –ë–æ–π</h3>                    <p class="text-gray-300 mb-4">–£–Ω–∏—á—Ç–æ–∂—å –≤—Ä–∞–≥–∞ –ø–µ—Ä–≤—ã–º!</p>                    <span class="inline-block bg-orange-500/30 text-orange-300 px-3 py-1 rounded-full text-sm">‚öîÔ∏è PvP</span>                </div>            </div>                        <!-- Multiplayer Games -->            <h3 class="text-xl font-bold mb-4 text-purple-300">üë• –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω—ã–µ –∏–≥—Ä—ã</h3>            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('tictactoe')">                    <div class="text-5xl mb-4 floating">‚ùå‚≠ï</div>                    <h3 class="text-xl font-bold mb-2">–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏</h3>                    <p class="text-gray-300 text-sm">–ö–ª–∞—Å—Å–∏–∫–∞ –¥–ª—è –¥–≤–æ–∏—Ö</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('rps')">                    <div class="text-5xl mb-4 floating">‚úä‚úã‚úåÔ∏è</div>                    <h3 class="text-xl font-bold mb-2">–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞</h3>                    <p class="text-gray-300 text-sm">–ë—ã—Å—Ç—Ä–∞—è –¥—É—ç–ª—å!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('quiz')">                    <div class="text-5xl mb-4 floating">üß©</div>                    <h3 class="text-xl font-bold mb-2">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h3>                    <p class="text-gray-300 text-sm">–ö—Ç–æ —É–º–Ω–µ–µ?</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('fruitcatcher')">                    <div class="text-5xl mb-4 floating">üß∫üçé</div>                    <h3 class="text-xl font-bold mb-2">–õ–æ–≤–µ—Ü —Ñ—Ä—É–∫—Ç–æ–≤</h3>                    <p class="text-gray-300 text-sm">–õ–æ–≤–∏ –±—ã—Å—Ç—Ä–µ–µ!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('clickbattle')">                    <div class="text-5xl mb-4 floating">üëÜüí•</div>                    <h3 class="text-xl font-bold mb-2">–ö–ª–∏–∫–µ—Ä-–ë–∞—Ç–ª</h3>                    <p class="text-gray-300 text-sm">–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('mathbattle')">                    <div class="text-5xl mb-4 floating">üî¢‚öîÔ∏è</div>                    <h3 class="text-xl font-bold mb-2">–ú–∞—Ç–µ–º. –±–æ–π</h3>                    <p class="text-gray-300 text-sm">–°—á–∏—Ç–∞–π –±—ã—Å—Ç—Ä–µ–µ!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('wordchain')">                    <div class="text-5xl mb-4 floating">üìùüîó</div>                    <h3 class="text-xl font-bold mb-2">–°–ª–æ–≤–∞</h3>                    <p class="text-gray-300 text-sm">–¶–µ–ø–æ—á–∫–∞ —Å–ª–æ–≤</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('colormatch')">                    <div class="text-5xl mb-4 floating">üé®üèÉ</div>                    <h3 class="text-xl font-bold mb-2">–¶–≤–µ—Ç–æ–≤–∞—è –≥–æ–Ω–∫–∞</h3>                    <p class="text-gray-300 text-sm">–í—ã–±–µ—Ä–∏ —Ü–≤–µ—Ç!</p>                </div>            </div>                        <!-- Solo Games -->            <h3 class="text-xl font-bold mb-4 text-blue-300">üèÜ –û–¥–∏–Ω–æ—á–Ω—ã–µ –∏–≥—Ä—ã</h3>            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('memory')">                    <div class="text-5xl mb-4 floating">üß†</div>                    <h3 class="text-xl font-bold mb-2">–ú–µ–º–æ—Ä–∏</h3>                    <p class="text-gray-300 text-sm">–ù–∞–π–¥–∏ –ø–∞—Ä—ã!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('reaction')">                    <div class="text-5xl mb-4 floating">‚ö°</div>                    <h3 class="text-xl font-bold mb-2">–†–µ–∞–∫—Ü–∏—è</h3>                    <p class="text-gray-300 text-sm">–ü—Ä–æ–≤–µ—Ä—å —Å–∫–æ—Ä–æ—Å—Ç—å!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('snake')">                    <div class="text-5xl mb-4 floating">üêç</div>                    <h3 class="text-xl font-bold mb-2">–ó–º–µ–π–∫–∞</h3>                    <p class="text-gray-300 text-sm">–ö–ª–∞—Å—Å–∏–∫–∞!</p>                </div>                                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('fruitcatchersolo')">                    <div class="text-5xl mb-4 floating">üß∫üçá</div>                    <h3 class="text-xl font-bold mb-2">–õ–æ–≤–µ—Ü —Ñ—Ä—É–∫—Ç–æ–≤</h3>                    <p class="text-gray-300 text-sm">–°–æ–ª–æ —Ä–µ–∂–∏–º</p>                </div>            </div>        </section>        <!-- Friends Section -->        <section id="friendsSection" class="max-w-4xl mx-auto p-6 hidden">            <h2 class="text-3xl font-black mb-6 gradient-text">üë• –î—Ä—É–∑—å—è</h2>                        <div class="glass rounded-2xl p-6 mb-6">                <h3 class="text-xl font-bold mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞</h3>                <div class="flex gap-4 flex-wrap">                    <input type="text" id="friendEmail" placeholder="Email –¥—Ä—É–≥–∞" class="flex-1 min-w-[200px] p-4 rounded-xl bg-white/10 border border-white/20 focus:outline-none focus:border-purple-500">                    <button onclick="addFriend()" class="btn-primary px-6 rounded-xl font-bold">–î–æ–±–∞–≤–∏—Ç—å</button>                </div>            </div>                        <div class="glass rounded-2xl p-6 mb-6">                <h3 class="text-xl font-bold mb-4">üì® –ó–∞–ø—Ä–æ—Å—ã –≤ –¥—Ä—É–∑—å—è</h3>                <div id="friendRequests" class="space-y-3">                    <p class="text-gray-400">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</p>                </div>            </div>                        <div class="glass rounded-2xl p-6">                <h3 class="text-xl font-bold mb-4">üë• –ú–æ–∏ –¥—Ä—É–∑—å—è</h3>                <div id="friendsList" class="space-y-3">                    <p class="text-gray-400">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>                </div>            </div>        </section>        <!-- Leaderboard Section -->        <section id="leaderboardSection" class="max-w-4xl mx-auto p-6 hidden">            <h2 class="text-3xl font-black mb-6 gradient-text">üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h2>                        <div class="flex gap-2 mb-6 flex-wrap">                <button onclick="showLeaderboard('snake')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">üêç –ó–º–µ–π–∫–∞</button>                <button onclick="showLeaderboard('memory')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">üß† –ú–µ–º–æ—Ä–∏</button>                <button onclick="showLeaderboard('reaction')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">‚ö° –†–µ–∞–∫—Ü–∏—è</button>                <button onclick="showLeaderboard('fruitcatcher')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">üß∫ –§—Ä—É–∫—Ç—ã</button>            </div>                        <div id="leaderboardContent" class="glass rounded-2xl p-6">                <div class="space-y-3" id="leaderboardList">                    <p class="text-gray-400 text-center">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</p>                </div>            </div>        </section>        <!-- Invites Section -->        <section id="invitesSection" class="max-w-4xl mx-auto p-6 hidden">            <h2 class="text-3xl font-black mb-6 gradient-text">üì® –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤ –∏–≥—Ä—ã</h2>            <div id="gameInvites" class="glass rounded-2xl p-6 space-y-4">                <p class="text-gray-400 text-center">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</p>            </div>        </section>    </div>    <!-- Game Modal -->    <div id="gameModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">        <div class="glass rounded-3xl p-6 w-full max-w-4xl max-h-[95vh] overflow-y-auto neon-glow">            <div class="flex justify-between items-center mb-6">                <h2 id="gameTitle" class="text-2xl font-black gradient-text">–ò–≥—Ä–∞</h2>                <button onclick="closeGame()" class="text-3xl hover:scale-110 transition-transform">‚ùå</button>            </div>            <div id="gameContent"></div>        </div>    </div>    <!-- Notification -->    <div id="notification" class="fixed bottom-4 right-4 glass rounded-xl p-4 hidden transform translate-y-20 transition-all z-50">        <p id="notificationText"></p>    </div>    <script>        // Firebase Config        const firebaseConfig = {            apiKey: "AIzaSyBKDnOlEP4wb8YfZkJ-b5qVzbZmCBn6G3A",            authDomain: "bucktupogub-ae41a.firebaseapp.com",            databaseURL: "https://bucktupogub-ae41a-default-rtdb.firebaseio.com",            projectId: "bucktupogub-ae41a",            storageBucket: "bucktupogub-ae41a.firebasestorage.app",            messagingSenderId: "974220682292",            appId: "1:974220682292:web:16f3696389804f2f4a5661",            measurementId: "G-QTZ59V95LN"        };        firebase.initializeApp(firebaseConfig);        const auth = firebase.auth();        const db = firebase.database();                let currentUser = null;        let currentGameId = null;        let gameListeners = [];        let gameIntervals = [];        // Create particles        function createParticles() {            const container = document.getElementById('particles');            const colors = ['#8b5cf6', '#ec4899', '#06b6d4', '#10b981', '#f59e0b'];            for (let i = 0; i < 25; i++) {                const particle = document.createElement('div');                particle.className = 'particle';                particle.style.left = Math.random() * 100 + '%';                particle.style.width = Math.random() * 10 + 5 + 'px';                particle.style.height = particle.style.width;                particle.style.background = colors[Math.floor(Math.random() * colors.length)];                particle.style.animationDelay = Math.random() * 15 + 's';                particle.style.opacity = Math.random() * 0.5 + 0.2;                container.appendChild(particle);            }        }        createParticles();        // Auth functions        function showAuthTab(tab) {            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');            document.getElementById('loginTab').classList.toggle('bg-purple-500', tab === 'login');            document.getElementById('registerTab').classList.toggle('bg-purple-500', tab === 'register');        }        async function login() {            const email = document.getElementById('loginEmail').value;            const password = document.getElementById('loginPassword').value;            try {                await auth.signInWithEmailAndPassword(email, password);            } catch (e) {                showAuthError(e.message);            }        }        async function register() {            const username = document.getElementById('regUsername').value;            const email = document.getElementById('regEmail').value;            const password = document.getElementById('regPassword').value;            try {                const cred = await auth.createUserWithEmailAndPassword(email, password);                await db.ref('users/' + cred.user.uid).set({                    username: username,                    email: email,                    createdAt: Date.now(),                    online: true                });            } catch (e) {                showAuthError(e.message);            }        }        function logout() {            if (currentUser) {                db.ref('users/' + currentUser.uid + '/online').set(false);            }            auth.signOut();        }        function showAuthError(msg) {            const el = document.getElementById('authError');            el.textContent = msg;            el.classList.remove('hidden');        }        auth.onAuthStateChanged(async (user) => {            if (user) {                currentUser = user;                const userData = await db.ref('users/' + user.uid).once('value');                const data = userData.val() || {};                                document.getElementById('userName').textContent = data.username || '–ò–≥—Ä–æ–∫';                document.getElementById('userAvatar').textContent = (data.username || '–ò')[0].toUpperCase();                                db.ref('users/' + user.uid + '/online').set(true);                db.ref('users/' + user.uid + '/online').onDisconnect().set(false);                                document.getElementById('authScreen').classList.add('hidden');                document.getElementById('mainApp').classList.remove('hidden');                                setupListeners();            } else {                currentUser = null;                document.getElementById('authScreen').classList.remove('hidden');                document.getElementById('mainApp').classList.add('hidden');            }        });        // Navigation        function showSection(section) {            ['games', 'friends', 'leaderboard', 'invites'].forEach(s => {                document.getElementById(s + 'Section').classList.add('hidden');            });            document.getElementById(section + 'Section').classList.remove('hidden');                        document.querySelectorAll('.nav-btn').forEach(btn => {                btn.classList.remove('bg-purple-500');                if (btn.dataset.section === section) btn.classList.add('bg-purple-500');            });        }        // Friends        async function addFriend() {            const email = document.getElementById('friendEmail').value.trim();            if (!email) return;                        const users = await db.ref('users').orderByChild('email').equalTo(email).once('value');            const data = users.val();                        if (!data) {                notify('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω üò¢');                return;            }                        const friendId = Object.keys(data)[0];            if (friendId === currentUser.uid) {                notify('–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è üòÖ');                return;            }                        await db.ref('friendRequests/' + friendId + '/' + currentUser.uid).set({                from: currentUser.uid,                timestamp: Date.now()            });                        document.getElementById('friendEmail').value = '';            notify('–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! ‚úâÔ∏è');        }        async function acceptFriend(friendId) {            await db.ref('friends/' + currentUser.uid + '/' + friendId).set(true);            await db.ref('friends/' + friendId + '/' + currentUser.uid).set(true);            await db.ref('friendRequests/' + currentUser.uid + '/' + friendId).remove();            notify('–î—Ä—É–≥ –¥–æ–±–∞–≤–ª–µ–Ω! üéâ');        }        async function declineFriend(friendId) {            await db.ref('friendRequests/' + currentUser.uid + '/' + friendId).remove();        }        const gameNames = {             tictactoe: '–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏',             rps: '–ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞',             quiz: '–í–∏–∫—Ç–æ—Ä–∏–Ω–∞',            fruitcatcher: '–õ–æ–≤–µ—Ü —Ñ—Ä—É–∫—Ç–æ–≤',            clickbattle: '–ö–ª–∏–∫–µ—Ä-–ë–∞—Ç–ª',            mathbattle: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–æ–π',            wordchain: '–°–ª–æ–≤–∞',            colormatch: '–¶–≤–µ—Ç–æ–≤–∞—è –≥–æ–Ω–∫–∞',            heist: '–û–≥—Ä–∞–±–ª–µ–Ω–∏–µ –ë–∞–Ω–∫–∞',            seabattle: '–ú–æ—Ä—Å–∫–æ–π –ë–æ–π',            tanks: '–¢–∞–Ω–∫–æ–≤—ã–π –ë–æ–π'        };        function setupListeners() {            // Friend requests            db.ref('friendRequests/' + currentUser.uid).on('value', async (snap) => {                const requests = snap.val() || {};                const container = document.getElementById('friendRequests');                                if (Object.keys(requests).length === 0) {                    container.innerHTML = '<p class="text-gray-400">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</p>';                    return;                }                                container.innerHTML = '';                for (const id of Object.keys(requests)) {                    const userData = await db.ref('users/' + id).once('value');                    const user = userData.val() || {};                    container.innerHTML += `                        <div class="flex items-center justify-between bg-white/10 rounded-xl p-4">                            <div class="flex items-center gap-3">                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center font-bold">${(user.username || '?')[0].toUpperCase()}</div>                                <span class="font-bold">${user.username || '–ò–≥—Ä–æ–∫'}</span>                            </div>                            <div class="flex gap-2">                                <button onclick="acceptFriend('${id}')" class="bg-green-500 px-4 py-2 rounded-lg font-bold hover:bg-green-600">‚úì</button>                                <button onclick="declineFriend('${id}')" class="bg-red-500 px-4 py-2 rounded-lg font-bold hover:bg-red-600">‚úï</button>                            </div>                        </div>                    `;                }            });            // Friends list            db.ref('friends/' + currentUser.uid).on('value', async (snap) => {                const friends = snap.val() || {};                const container = document.getElementById('friendsList');                                if (Object.keys(friends).length === 0) {                    container.innerHTML = '<p class="text-gray-400">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</p>';                    return;                }                                container.innerHTML = '';                for (const id of Object.keys(friends)) {                    const userData = await db.ref('users/' + id).once('value');                    const user = userData.val() || {};                    const online = user.online ? '<span class="w-3 h-3 bg-green-500 rounded-full online-dot"></span>' : '<span class="w-3 h-3 bg-gray-500 rounded-full"></span>';                    container.innerHTML += `                        <div class="flex items-center justify-between bg-white/10 rounded-xl p-4 flex-wrap gap-2">                            <div class="flex items-center gap-3">                                ${online}                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center font-bold">${(user.username || '?')[0].toUpperCase()}</div>                                <span class="font-bold">${user.username || '–ò–≥—Ä–æ–∫'}</span>                            </div>                            <button onclick="inviteToGame('${id}')" class="btn-primary px-4 py-2 rounded-lg font-bold ${user.online ? '' : 'opacity-50 cursor-not-allowed'}" ${user.online ? '' : 'disabled'}>üéÆ –ò–≥—Ä–∞—Ç—å</button>                        </div>                    `;                }            });            // Game invites            db.ref('gameInvites/' + currentUser.uid).on('value', async (snap) => {                const invites = snap.val() || {};                const container = document.getElementById('gameInvites');                const keys = Object.keys(invites);                                document.getElementById('invitesBadge').classList.toggle('hidden', keys.length === 0);                document.getElementById('invitesBadge').textContent = keys.length;                                if (keys.length === 0) {                    container.innerHTML = '<p class="text-gray-400 text-center">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</p>';                    return;                }                                container.innerHTML = '';                for (const id of keys) {                    const invite = invites[id];                    const userData = await db.ref('users/' + invite.from).once('value');                    const user = userData.val() || {};                    container.innerHTML += `                        <div class="flex items-center justify-between bg-white/10 rounded-xl p-4 flex-wrap gap-2">                            <div>                                <div class="font-bold">${user.username || '–ò–≥—Ä–æ–∫'}</div>                                <div class="text-gray-300">${gameNames[invite.game] || invite.game}</div>                            </div>                            <div class="flex gap-2">                                <button onclick="joinGame('${id}', '${invite.game}', '${invite.gameId}')" class="bg-green-500 px-4 py-2 rounded-lg font-bold hover:bg-green-600">–ü—Ä–∏–Ω—è—Ç—å</button>                                <button onclick="declineInvite('${id}')" class="bg-red-500 px-4 py-2 rounded-lg font-bold hover:bg-red-600">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>                            </div>                        </div>                    `;                }            });        }        function inviteToGame(friendId) {            const gameOptions = Object.entries(gameNames).map(([key, name]) => {                if (['memory', 'reaction', 'snake', 'fruitcatchersolo'].includes(key)) return '';                const icons = {                    tictactoe: '‚ùå‚≠ï', rps: '‚úä‚úã‚úåÔ∏è', quiz: 'üß©', fruitcatcher: 'üß∫üçé',                    clickbattle: 'üëÜüí•', mathbattle: 'üî¢‚öîÔ∏è', wordchain: 'üìùüîó', colormatch: 'üé®',                    heist: 'üè¶üí∞', seabattle: 'üö¢üí•', tanks: 'üî´üéØ'                };                return `<button onclick="sendGameInvite('${friendId}', '${key}')" class="glass p-4 rounded-xl hover:bg-purple-500/50 transition-all">                    <div class="text-3xl mb-2">${icons[key] || 'üéÆ'}</div>                    <div class="text-sm font-bold">${name}</div>                </button>`;            }).join('');                        document.getElementById('gameContent').innerHTML = `                <div class="text-center">                    <h3 class="text-xl font-bold mb-6">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</h3>                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">${gameOptions}</div>                </div>            `;            document.getElementById('gameTitle').textContent = 'üéÆ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞';            document.getElementById('gameModal').classList.remove('hidden');        }        async function sendGameInvite(friendId, game) {            const gameId = db.ref('games').push().key;                        await db.ref('games/' + gameId).set({                type: game,                player1: currentUser.uid,                player2: friendId,                status: 'waiting',                createdAt: Date.now()            });                        await db.ref('gameInvites/' + friendId + '/' + Date.now()).set({                from: currentUser.uid,                game: game,                gameId: gameId            });                        closeGame();            notify('–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! üì®');            waitForOpponent(gameId, game);        }        function waitForOpponent(gameId, game) {            document.getElementById('gameContent').innerHTML = `                <div class="text-center py-12">                    <div class="text-6xl mb-4 floating">‚è≥</div>                    <h3 class="text-xl font-bold mb-2">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...</h3>                    <p class="text-gray-300">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</p>                </div>            `;            document.getElementById('gameTitle').textContent = 'üéÆ –û–∂–∏–¥–∞–Ω–∏–µ';            document.getElementById('gameModal').classList.remove('hidden');                        const listener = db.ref('games/' + gameId + '/status').on('value', (snap) => {                if (snap.val() === 'playing') {                    db.ref('games/' + gameId + '/status').off('value', listener);                    startMultiplayerGame(gameId, game);                }            });            gameListeners.push({ ref: 'games/' + gameId + '/status', callback: listener });        }        async function joinGame(inviteId, game, gameId) {            await db.ref('gameInvites/' + currentUser.uid + '/' + inviteId).remove();            await db.ref('games/' + gameId + '/status').set('playing');            startMultiplayerGame(gameId, game);        }        async function declineInvite(inviteId) {            await db.ref('gameInvites/' + currentUser.uid + '/' + inviteId).remove();        }        // Games        function openGame(game) {            document.getElementById('gameModal').classList.remove('hidden');                        const multiplayerGames = ['tictactoe', 'rps', 'quiz', 'fruitcatcher', 'clickbattle', 'mathbattle', 'wordchain', 'colormatch', 'heist', 'seabattle', 'tanks'];                        if (multiplayerGames.includes(game)) {                showMultiplayerOnly(game);            } else {                switch(game) {                    case 'memory': initMemory(); break;                    case 'reaction': initReaction(); break;                    case 'snake': initSnake(); break;                    case 'fruitcatchersolo': initFruitCatcherSolo(); break;                }            }        }        function showMultiplayerOnly(game) {            document.getElementById('gameTitle').textContent = gameNames[game] || game;            document.getElementById('gameContent').innerHTML = `                <div class="text-center py-8">                    <div class="text-6xl mb-4">üë•</div>                    <h3 class="text-xl font-bold mb-2">–ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–∞—è –∏–≥—Ä–∞</h3>                    <p class="text-gray-300 mb-6">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å!</p>                    <button onclick="showSection('friends'); closeGame();" class="btn-primary px-6 py-3 rounded-xl font-bold">–ü–µ—Ä–µ–π—Ç–∏ –∫ –¥—Ä—É–∑—å—è–º üë•</button>                </div>            `;        }        function closeGame() {            document.getElementById('gameModal').classList.add('hidden');            gameListeners.forEach(l => {                try { db.ref(l.ref).off('value', l.callback); } catch(e) {}            });            gameListeners = [];            gameIntervals.forEach(i => clearInterval(i));            gameIntervals = [];            currentGameId = null;        }        function startMultiplayerGame(gameId, game) {            currentGameId = gameId;            document.getElementById('gameModal').classList.remove('hidden');            switch(game) {                case 'tictactoe': initMultiplayerTicTacToe(gameId); break;                case 'rps': initMultiplayerRPS(gameId); break;                case 'quiz': initMultiplayerQuiz(gameId); break;                case 'fruitcatcher': initMultiplayerFruitCatcher(gameId); break;                case 'clickbattle': initMultiplayerClickBattle(gameId); break;                case 'mathbattle': initMultiplayerMathBattle(gameId); break;                case 'wordchain': initMultiplayerWordChain(gameId); break;                case 'colormatch': initMultiplayerColorMatch(gameId); break;                case 'heist': initMultiplayerHeist(gameId); break;                case 'seabattle': initMultiplayerSeaBattle(gameId); break;                case 'tanks': initMultiplayerTanks(gameId); break;            }        }        // ==================== BANK HEIST ====================        async function initMultiplayerHeist(gameId) {            document.getElementById('gameTitle').textContent = 'üè¶ –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ –ë–∞–Ω–∫–∞';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;            const isRobber = isPlayer1; // Player 1 is robber, Player 2 is police                        const arenaSize = 12;                        if (isPlayer1 && !game.arena) {                await db.ref('games/' + gameId).update({                    robberX: 1, robberY: 1,                    policeX: arenaSize - 2, policeY: arenaSize - 2,                    goldX: Math.floor(arenaSize / 2), goldY: Math.floor(arenaSize / 2),                    exitX: arenaSize - 2, exitY: 1,                    hasGold: false,                    winner: null,                    timeLeft: 60                });                                // Timer                const timerInterval = setInterval(async () => {                    const snap = await db.ref('games/' + gameId + '/timeLeft').once('value');                    const time = snap.val();                    if (time !== null && time > 0) {                        await db.ref('games/' + gameId + '/timeLeft').set(time - 1);                    } else if (time === 0) {                        clearInterval(timerInterval);                        await db.ref('games/' + gameId + '/winner').set('police');                    }                }, 1000);                gameIntervals.push(timerInterval);            }                        function render(data) {                if (!data) return;                                if (data.winner) {                    const iWon = (data.winner === 'robber' && isRobber) || (data.winner === 'police' && !isRobber);                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-8xl mb-4">${iWon ? 'üéâ' : 'üò¢'}</div>                            <p class="text-3xl font-bold ${iWon ? 'text-green-400' : 'text-red-400'} mb-4">                                ${iWon ? '–í—ã –ø–æ–±–µ–¥–∏–ª–∏!' : '–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!'}                            </p>                            <p class="text-xl text-gray-300">                                ${data.winner === 'robber' ? 'üí∞ –ì—Ä–∞–±–∏—Ç–µ–ª—å —É–∫—Ä–∞–ª –∑–æ–ª–æ—Ç–æ!' : 'üëÆ –ü–æ–ª–∏—Ü–∏—è –ø–æ–π–º–∞–ª–∞ –≥—Ä–∞–±–∏—Ç–µ–ª—è!'}                            </p>                        </div>                    `;                    return;                }                                let grid = '';                for (let y = 0; y < arenaSize; y++) {                    for (let x = 0; x < arenaSize; x++) {                        let content = '';                        let cellClass = 'bg-gray-800/50';                                                // Walls                        if (x === 0 || x === arenaSize - 1 || y === 0 || y === arenaSize - 1) {                            if (!(x === data.exitX && y === data.exitY)) {                                cellClass = 'bg-gray-600';                            }                        }                                                // Exit                        if (x === data.exitX && y === data.exitY) {                            content = 'üö™';                            cellClass = 'bg-green-900/50';                        }                                                // Gold (if not picked up)                        if (!data.hasGold && x === data.goldX && y === data.goldY) {                            content = 'üí∞';                            cellClass = 'bg-yellow-900/30';                        }                                                // Police                        if (x === data.policeX && y === data.policeY) {                            content = 'üëÆ';                            cellClass = 'bg-blue-900/50 police-glow';                        }                                                // Robber                        if (x === data.robberX && y === data.robberY) {                            content = data.hasGold ? 'ü¶πüí∞' : 'ü¶π';                            cellClass = 'bg-red-900/50 robber-glow';                        }                                                grid += `<div class="aspect-square flex items-center justify-center text-lg sm:text-2xl rounded ${cellClass}">${content}</div>`;                    }                }                                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-4">                        <div class="flex justify-between items-center mb-2">                            <span class="text-lg ${isRobber ? 'text-red-400 font-bold' : 'text-blue-400'}">                                ${isRobber ? 'ü¶π –í—ã - –ì—Ä–∞–±–∏—Ç–µ–ª—å' : 'üëÆ –í—ã - –ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π'}                            </span>                            <span class="text-xl font-bold">‚è±Ô∏è ${data.timeLeft || 0}—Å</span>                        </div>                        <p class="text-sm text-gray-300">                            ${isRobber ? '–£–∫—Ä–∞–¥–∏—Ç–µ üí∞ –∏ –¥–æ–Ω–µ—Å–∏—Ç–µ –¥–æ üö™!' : '–ü–æ–π–º–∞–π—Ç–µ –≥—Ä–∞–±–∏—Ç–µ–ª—è! ü¶π'}                        </p>                    </div>                    <div class="grid gap-1 max-w-md mx-auto mb-4" style="grid-template-columns: repeat(${arenaSize}, 1fr)">                        ${grid}                    </div>                    <div class="flex flex-col items-center gap-2">                        <button onclick="heistMove(0,-1)" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚¨ÜÔ∏è</button>                        <div class="flex gap-2">                            <button onclick="heistMove(-1,0)" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚¨ÖÔ∏è</button>                            <button onclick="heistMove(0,1)" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚¨áÔ∏è</button>                            <button onclick="heistMove(1,0)" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚û°Ô∏è</button>                        </div>                    </div>                `;            }                        window.heistMove = async function(dx, dy) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.winner) return;                                let newX, newY;                if (isRobber) {                    newX = data.robberX + dx;                    newY = data.robberY + dy;                } else {                    newX = data.policeX + dx;                    newY = data.policeY + dy;                }                                // Check walls                if (newX < 0 || newX >= arenaSize || newY < 0 || newY >= arenaSize) return;                if ((newX === 0 || newX === arenaSize - 1 || newY === 0 || newY === arenaSize - 1) &&                     !(newX === data.exitX && newY === data.exitY)) return;                                const updates = {};                                if (isRobber) {                    updates.robberX = newX;                    updates.robberY = newY;                                        // Pick up gold                    if (newX === data.goldX && newY === data.goldY && !data.hasGold) {                        updates.hasGold = true;                    }                                        // Reach exit with gold                    if (newX === data.exitX && newY === data.exitY && data.hasGold) {                        updates.winner = 'robber';                    }                                        // Caught by police                    if (newX === data.policeX && newY === data.policeY) {                        updates.winner = 'police';                    }                } else {                    updates.policeX = newX;                    updates.policeY = newY;                                        // Catch robber                    if (newX === data.robberX && newY === data.robberY) {                        updates.winner = 'police';                    }                }                                await db.ref('games/' + gameId).update(updates);            };                        // Keyboard controls            document.onkeydown = (e) => {                if (e.key === 'ArrowUp') heistMove(0, -1);                if (e.key === 'ArrowDown') heistMove(0, 1);                if (e.key === 'ArrowLeft') heistMove(-1, 0);                if (e.key === 'ArrowRight') heistMove(1, 0);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                render(snap.val());            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // ==================== SEA BATTLE ====================        async function initMultiplayerSeaBattle(gameId) {            document.getElementById('gameTitle').textContent = 'üö¢ –ú–æ—Ä—Å–∫–æ–π –ë–æ–π';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;            const gridSize = 8;                        if (isPlayer1 && !game.phase) {                await db.ref('games/' + gameId).update({                    phase: 'placing',                    ships1: [], ships2: [],                    shots1: [], shots2: [],                    ready1: false, ready2: false,                    turn: 1                });            }                        let myShips = [];            let currentShipSize = 3;            let isHorizontal = true;                        function render(data) {                if (!data) return;                                const myReady = isPlayer1 ? data.ready1 : data.ready2;                const oppReady = isPlayer1 ? data.ready2 : data.ready1;                const myShipsData = isPlayer1 ? (data.ships1 || []) : (data.ships2 || []);                const oppShots = isPlayer1 ? (data.shots2 || []) : (data.shots1 || []);                const myShots = isPlayer1 ? (data.shots1 || []) : (data.shots2 || []);                const oppShips = isPlayer1 ? (data.ships2 || []) : (data.ships1 || []);                const isMyTurn = (data.turn === 1 && isPlayer1) || (data.turn === 2 && !isPlayer1);                                // Check winner                if (data.winner) {                    const iWon = (data.winner === 1 && isPlayer1) || (data.winner === 2 && !isPlayer1);                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-8xl mb-4">${iWon ? 'üèÜ' : 'üí•'}</div>                            <p class="text-3xl font-bold ${iWon ? 'text-green-400' : 'text-red-400'}">                                ${iWon ? '–ü–æ–±–µ–¥–∞! –í—ã –ø–æ—Ç–æ–ø–∏–ª–∏ —Ñ–ª–æ—Ç!' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –í–∞—à —Ñ–ª–æ—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω!'}                            </p>                        </div>                    `;                    return;                }                                if (data.phase === 'placing') {                    let myGrid = '';                    for (let y = 0; y < gridSize; y++) {                        for (let x = 0; x < gridSize; x++) {                            const hasShip = myShips.some(s => s.x === x && s.y === y);                            myGrid += `<div onclick="placeShip(${x},${y})" class="aspect-square ship-cell rounded flex items-center justify-center cursor-pointer ${hasShip ? 'bg-blue-500' : 'bg-blue-900/30'} border border-blue-500/30">${hasShip ? 'üö¢' : ''}</div>`;                        }                    }                                        document.getElementById('gameContent').innerHTML = `                        <div class="text-center mb-4">                            <p class="text-xl font-bold mb-2">–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –∫–æ—Ä–∞–±–ª–∏</p>                            <p class="text-gray-300">–ö–æ—Ä–∞–±–ª—å: ${currentShipSize} –∫–ª–µ—Ç–æ–∫ | ${isHorizontal ? '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ' : '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ'}</p>                            <button onclick="toggleShipDirection()" class="glass px-4 py-2 rounded-lg mt-2">üîÑ –ü–æ–≤–µ—Ä–Ω—É—Ç—å</button>                        </div>                        <div class="grid gap-1 max-w-xs mx-auto mb-4" style="grid-template-columns: repeat(${gridSize}, 1fr)">                            ${myGrid}                        </div>                        <div class="text-center">                            <p class="text-sm text-gray-400 mb-2">–ö–æ—Ä–∞–±–ª–µ–π: ${myShips.length}/5</p>                            ${myShips.length >= 5 ? `<button onclick="confirmShips()" class="btn-primary px-6 py-3 rounded-xl font-bold">–ì–æ—Ç–æ–≤ –∫ –±–æ—é! ‚öîÔ∏è</button>` : ''}                        </div>                    `;                } else if (data.phase === 'battle') {                    let myGrid = '', oppGrid = '';                                        for (let y = 0; y < gridSize; y++) {                        for (let x = 0; x < gridSize; x++) {                            const hasShip = myShipsData.some(s => s.x === x && s.y === y);                            const isShot = oppShots.some(s => s.x === x && s.y === y);                            let cellClass = hasShip ? 'bg-blue-500' : 'bg-blue-900/30';                            let content = hasShip ? 'üö¢' : '';                            if (isShot) {                                cellClass = hasShip ? 'bg-red-500' : 'bg-gray-600';                                content = hasShip ? 'üí•' : 'üí®';                            }                            myGrid += `<div class="aspect-square rounded flex items-center justify-center ${cellClass} border border-blue-500/30 text-sm">${content}</div>`;                        }                    }                                        for (let y = 0; y < gridSize; y++) {                        for (let x = 0; x < gridSize; x++) {                            const isShot = myShots.some(s => s.x === x && s.y === y);                            const hitShip = isShot && oppShips.some(s => s.x === x && s.y === y);                            let cellClass = 'bg-gray-800/50 cursor-pointer hover:bg-gray-600';                            let content = '';                            if (isShot) {                                cellClass = hitShip ? 'bg-red-500' : 'bg-gray-600';                                content = hitShip ? 'üí•' : 'üí®';                            }                            oppGrid += `<div onclick="shoot(${x},${y})" class="aspect-square rounded flex items-center justify-center ${cellClass} border border-gray-500/30 text-sm">${content}</div>`;                        }                    }                                        document.getElementById('gameContent').innerHTML = `                        <div class="text-center mb-4">                            <p class="text-xl font-bold ${isMyTurn ? 'text-green-400' : 'text-gray-400'}">                                ${isMyTurn ? 'üéØ –í–∞—à —Ö–æ–¥! –°—Ç—Ä–µ–ª—è–π—Ç–µ!' : '‚è≥ –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...'}                            </p>                        </div>                        <div class="grid grid-cols-2 gap-4">                            <div>                                <p class="text-center text-sm mb-2 text-gray-300">–í–∞—à–µ –ø–æ–ª–µ</p>                                <div class="grid gap-0.5" style="grid-template-columns: repeat(${gridSize}, 1fr)">${myGrid}</div>                            </div>                            <div>                                <p class="text-center text-sm mb-2 text-gray-300">–ü–æ–ª–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</p>                                <div class="grid gap-0.5" style="grid-template-columns: repeat(${gridSize}, 1fr)">${oppGrid}</div>                            </div>                        </div>                    `;                } else {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-6xl mb-4 floating">‚è≥</div>                            <p class="text-xl">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>                            <p class="text-gray-300">${myReady ? '–í—ã –≥–æ—Ç–æ–≤—ã!' : '–†–∞—Å—Å—Ç–∞–≤–ª—è–µ—Ç–µ –∫–æ—Ä–∞–±–ª–∏...'} | ${oppReady ? '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –≥–æ—Ç–æ–≤!' : '–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ —Ä–∞—Å—Å—Ç–∞–≤–ª—è–µ—Ç...'}</p>                        </div>                    `;                }            }                        window.toggleShipDirection = function() {                isHorizontal = !isHorizontal;                render({ phase: 'placing' });            };                        window.placeShip = function(x, y) {                if (myShips.length >= 5) return;                                const shipSizes = [3, 3, 2, 2, 1];                currentShipSize = shipSizes[myShips.length];                                const newShipCells = [];                for (let i = 0; i < currentShipSize; i++) {                    const sx = isHorizontal ? x + i : x;                    const sy = isHorizontal ? y : y + i;                    if (sx >= gridSize || sy >= gridSize) return;                    if (myShips.some(s => s.x === sx && s.y === sy)) return;                    newShipCells.push({ x: sx, y: sy });                }                                myShips.push(...newShipCells);                render({ phase: 'placing' });            };                        window.confirmShips = async function() {                const field = isPlayer1 ? 'ships1' : 'ships2';                const readyField = isPlayer1 ? 'ready1' : 'ready2';                await db.ref('games/' + gameId + '/' + field).set(myShips);                await db.ref('games/' + gameId + '/' + readyField).set(true);                                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.ready1 && data.ready2) {                    await db.ref('games/' + gameId + '/phase').set('battle');                }            };                        window.shoot = async function(x, y) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                const isMyTurn = (data.turn === 1 && isPlayer1) || (data.turn === 2 && !isPlayer1);                if (!isMyTurn) return;                                const myShots = isPlayer1 ? (data.shots1 || []) : (data.shots2 || []);                if (myShots.some(s => s.x === x && s.y === y)) return;                                const shotsField = isPlayer1 ? 'shots1' : 'shots2';                const newShots = [...myShots, { x, y }];                await db.ref('games/' + gameId + '/' + shotsField).set(newShots);                                const oppShips = isPlayer1 ? (data.ships2 || []) : (data.ships1 || []);                const hit = oppShips.some(s => s.x === x && s.y === y);                                const allHit = oppShips.every(s => newShots.some(shot => shot.x === s.x && shot.y === s.y));                if (allHit) {                    await db.ref('games/' + gameId + '/winner').set(isPlayer1 ? 1 : 2);                } else if (!hit) {                    await db.ref('games/' + gameId + '/turn').set(data.turn === 1 ? 2 : 1);                }            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                render(snap.val());            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // ==================== TANK BATTLE ====================        async function initMultiplayerTanks(gameId) {            document.getElementById('gameTitle').textContent = 'üî´ –¢–∞–Ω–∫–æ–≤—ã–π –ë–æ–π';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;            const arenaSize = 10;                        if (isPlayer1 && !game.tank1) {                await db.ref('games/' + gameId).update({                    tank1: { x: 1, y: Math.floor(arenaSize / 2), dir: 'right', hp: 3 },                    tank2: { x: arenaSize - 2, y: Math.floor(arenaSize / 2), dir: 'left', hp: 3 },                    bullets: [],                    winner: null                });                                // Game loop                const gameLoop = setInterval(async () => {                    const snap = await db.ref('games/' + gameId).once('value');                    const data = snap.val();                    if (!data || data.winner) {                        clearInterval(gameLoop);                        return;                    }                                        let bullets = data.bullets || [];                    let tank1 = data.tank1;                    let tank2 = data.tank2;                    let updates = {};                                        // Move bullets                    bullets = bullets.map(b => {                        switch(b.dir) {                            case 'up': b.y--; break;                            case 'down': b.y++; break;                            case 'left': b.x--; break;                            case 'right': b.x++; break;                        }                        return b;                    }).filter(b => b.x >= 0 && b.x < arenaSize && b.y >= 0 && b.y < arenaSize);                                        // Check hits                    bullets = bullets.filter(b => {                        if (b.owner !== 1 && b.x === tank1.x && b.y === tank1.y) {                            tank1.hp--;                            return false;                        }                        if (b.owner !== 2 && b.x === tank2.x && b.y === tank2.y) {                            tank2.hp--;                            return false;                        }                        return true;                    });                                        updates.bullets = bullets;                    updates.tank1 = tank1;                    updates.tank2 = tank2;                                        if (tank1.hp <= 0) updates.winner = 2;                    if (tank2.hp <= 0) updates.winner = 1;                                        await db.ref('games/' + gameId).update(updates);                }, 200);                gameIntervals.push(gameLoop);            }                        function render(data) {                if (!data || !data.tank1) return;                                if (data.winner) {                    const iWon = (data.winner === 1 && isPlayer1) || (data.winner === 2 && !isPlayer1);                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-8xl mb-4">${iWon ? 'üèÜ' : 'üí•'}</div>                            <p class="text-3xl font-bold ${iWon ? 'text-green-400' : 'text-red-400'}">                                ${iWon ? '–ü–æ–±–µ–¥–∞!' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!'}                            </p>                        </div>                    `;                    return;                }                                const myTank = isPlayer1 ? data.tank1 : data.tank2;                const oppTank = isPlayer1 ? data.tank2 : data.tank1;                const dirEmoji = { up: '‚¨ÜÔ∏è', down: '‚¨áÔ∏è', left: '‚¨ÖÔ∏è', right: '‚û°Ô∏è' };                                let grid = '';                for (let y = 0; y < arenaSize; y++) {                    for (let x = 0; x < arenaSize; x++) {                        let content = '';                        let cellClass = 'bg-gray-800/30';                                                // Bullets                        const bullet = (data.bullets || []).find(b => b.x === x && b.y === y);                        if (bullet) {                            content = '‚Ä¢';                            cellClass = 'bg-yellow-500/50';                        }                                                // Tanks                        if (x === data.tank1.x && y === data.tank1.y) {                            content = 'üîµ';                            cellClass = isPlayer1 ? 'bg-blue-500/50' : 'bg-red-500/30';                        }                        if (x === data.tank2.x && y === data.tank2.y) {                            content = 'üî¥';                            cellClass = !isPlayer1 ? 'bg-blue-500/50' : 'bg-red-500/30';                        }                                                grid += `<div class="aspect-square flex items-center justify-center rounded ${cellClass} text-xl">${content}</div>`;                    }                }                                document.getElementById('gameContent').innerHTML = `                    <div class="flex justify-between mb-4">                        <div class="text-lg">–í—ã: ${'‚ù§Ô∏è'.repeat(myTank.hp)}</div>                        <div class="text-lg">–í—Ä–∞–≥: ${'üñ§'.repeat(oppTank.hp)}</div>                    </div>                    <div class="grid gap-0.5 max-w-md mx-auto mb-4" style="grid-template-columns: repeat(${arenaSize}, 1fr)">                        ${grid}                    </div>                    <div class="flex flex-col items-center gap-2">                        <button onclick="tankMove('up')" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚¨ÜÔ∏è</button>                        <div class="flex gap-2">                            <button onclick="tankMove('left')" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚¨ÖÔ∏è</button>                            <button onclick="tankShoot()" class="glass px-8 py-3 rounded-xl text-2xl active:bg-red-500/50 bg-red-900/30">üî•</button>                            <button onclick="tankMove('right')" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚û°Ô∏è</button>                        </div>                        <button onclick="tankMove('down')" class="glass px-8 py-3 rounded-xl text-2xl active:bg-purple-500/50">‚¨áÔ∏è</button>                    </div>                `;            }                        window.tankMove = async function(dir) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.winner) return;                                const tankField = isPlayer1 ? 'tank1' : 'tank2';                const tank = data[tankField];                                let newX = tank.x, newY = tank.y;                switch(dir) {                    case 'up': newY--; break;                    case 'down': newY++; break;                    case 'left': newX--; break;                    case 'right': newX++; break;                }                                if (newX < 0 || newX >= arenaSize || newY < 0 || newY >= arenaSize) return;                                await db.ref('games/' + gameId + '/' + tankField).update({                    x: newX, y: newY, dir: dir                });            };                        window.tankShoot = async function() {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.winner) return;                                const tank = isPlayer1 ? data.tank1 : data.tank2;                const bullets = data.bullets || [];                                bullets.push({                    x: tank.x, y: tank.y, dir: tank.dir, owner: isPlayer1 ? 1 : 2                });                                await db.ref('games/' + gameId + '/bullets').set(bullets);            };                        // Keyboard            document.onkeydown = (e) => {                if (e.key === 'ArrowUp') tankMove('up');                if (e.key === 'ArrowDown') tankMove('down');                if (e.key === 'ArrowLeft') tankMove('left');                if (e.key === 'ArrowRight') tankMove('right');                if (e.key === ' ') tankShoot();            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                render(snap.val());            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // ==================== FRUIT CATCHER (FIXED) ====================        async function initMultiplayerFruitCatcher(gameId) {            document.getElementById('gameTitle').textContent = 'üß∫ –õ–æ–≤–µ—Ü —Ñ—Ä—É–∫—Ç–æ–≤';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        const fruitEmojis = ['üçé', 'üçä', 'üçã', 'üçá', 'üçì', 'üçë', 'üçí', 'ü•ù'];            const gameDuration = 30;                        if (isPlayer1 && !game.gameStarted) {                await db.ref('games/' + gameId).update({                    score1: 0, score2: 0,                    gameStarted: true,                    startTime: Date.now(),                    winner: null                });            }                        let basketPos = 50;            let localScore = 0;            let fruits = [];            let gameEnded = false;            let lastUpdate = 0;                        function spawnFruit() {                fruits.push({                    id: Date.now() + Math.random(),                    emoji: fruitEmojis[Math.floor(Math.random() * fruitEmojis.length)],                    x: Math.random() * 80 + 10,                    y: 0                });            }                        function gameLoop() {                if (gameEnded) return;                                fruits.forEach(f => f.y += 2);                                fruits = fruits.filter(f => {                    if (f.y >= 85 && f.y <= 100 && Math.abs(f.x - basketPos) < 12) {                        localScore++;                        return false;                    }                    return f.y < 100;                });                                renderLocal();            }                        function renderLocal() {                const container = document.getElementById('fruitsContainer');                const scoreEl = document.getElementById('myScore');                if (container) {                    container.innerHTML = fruits.map(f =>                         `<div class="absolute text-3xl" style="left:${f.x}%;top:${f.y}%;transform:translateX(-50%)">${f.emoji}</div>`                    ).join('');                }                if (scoreEl) scoreEl.textContent = localScore;                                const basket = document.getElementById('basket');                if (basket) basket.style.left = basketPos + '%';            }                        function render(data) {                if (gameEnded) return;                                const timeElapsed = Math.floor((Date.now() - data.startTime) / 1000);                const timeLeft = Math.max(0, gameDuration - timeElapsed);                                const myScore = isPlayer1 ? data.score1 : data.score2;                const oppScore = isPlayer1 ? data.score2 : data.score1;                                if (timeLeft <= 0 && !gameEnded) {                    gameEnded = true;                    const iWon = localScore > oppScore;                    const isDraw = localScore === oppScore;                                        document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-6xl mb-4">${iWon ? 'üèÜ' : isDraw ? 'ü§ù' : 'üò¢'}</div>                            <div class="flex justify-center gap-8 mb-4">                                <div class="text-center">                                    <p class="text-gray-300">–í—ã</p>                                    <p class="text-4xl font-bold text-green-400">${localScore}</p>                                </div>                                <div class="text-center">                                    <p class="text-gray-300">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</p>                                    <p class="text-4xl font-bold text-red-400">${oppScore}</p>                                </div>                            </div>                            <p class="text-2xl font-bold ${iWon ? 'text-green-400' : isDraw ? 'text-yellow-400' : 'text-red-400'}">                                ${iWon ? '–ü–æ–±–µ–¥–∞! üéâ' : isDraw ? '–ù–∏—á—å—è!' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢'}                            </p>                        </div>                    `;                    return;                }                                document.getElementById('gameContent').innerHTML = `                    <div class="flex justify-between mb-4">                        <p class="text-lg">–í—ã: <span id="myScore" class="font-bold text-green-400">${localScore}</span></p>                        <p class="text-xl font-bold">‚è±Ô∏è ${timeLeft}—Å</p>                        <p class="text-lg">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: <span class="font-bold text-red-400">${oppScore}</span></p>                    </div>                    <div id="fruitGameArea" class="relative bg-gradient-to-b from-sky-900/50 to-green-900/50 rounded-2xl h-72 overflow-hidden">                        <div id="fruitsContainer"></div>                        <div id="basket" class="absolute bottom-2 text-5xl transition-all" style="left:${basketPos}%;transform:translateX(-50%)">üß∫</div>                    </div>                    <div class="flex justify-center gap-4 mt-4">                        <button onmousedown="fcMoveStart(-1)" onmouseup="fcMoveStop()" onmouseleave="fcMoveStop()" ontouchstart="fcMoveStart(-1)" ontouchend="fcMoveStop()" class="glass px-10 py-4 rounded-xl text-3xl font-bold active:bg-purple-500/50 select-none">‚¨ÖÔ∏è</button>                        <button onmousedown="fcMoveStart(1)" onmouseup="fcMoveStop()" onmouseleave="fcMoveStop()" ontouchstart="fcMoveStart(1)" ontouchend="fcMoveStop()" class="glass px-10 py-4 rounded-xl text-3xl font-bold active:bg-purple-500/50 select-none">‚û°Ô∏è</button>                    </div>                `;            }                        let moveInterval = null;            window.fcMoveStart = function(dir) {                fcMoveStop();                moveInterval = setInterval(() => {                    basketPos = Math.max(8, Math.min(92, basketPos + dir * 4));                    renderLocal();                }, 30);            };                        window.fcMoveStop = function() {                if (moveInterval) {                    clearInterval(moveInterval);                    moveInterval = null;                }            };                        // Update score periodically            const scoreInterval = setInterval(async () => {                if (gameEnded) return;                const field = isPlayer1 ? 'score1' : 'score2';                await db.ref('games/' + gameId + '/' + field).set(localScore);            }, 500);                        const spawnInterval = setInterval(spawnFruit, 600);            const loopInterval = setInterval(gameLoop, 50);                        gameIntervals.push(scoreInterval, spawnInterval, loopInterval);                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                render(snap.val() || {});            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // ==================== OTHER GAMES (TicTacToe, RPS, etc.) ====================                async function initMultiplayerTicTacToe(gameId) {            document.getElementById('gameTitle').textContent = '‚ùå‚≠ï –ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;            const mySymbol = isPlayer1 ? 'X' : 'O';                        if (!game.board) {                await db.ref('games/' + gameId + '/board').set(['', '', '', '', '', '', '', '', '']);                await db.ref('games/' + gameId + '/turn').set('X');            }                        function render(data) {                if (!data || !data.board) return;                const isMyTurn = data.turn === mySymbol;                                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-4">                        <p class="text-lg text-gray-300">–í—ã: ${mySymbol === 'X' ? '‚ùå' : '‚≠ï'}</p>                        <p class="text-xl font-bold">${data.winner ? (data.winner === 'draw' ? '–ù–∏—á—å—è! ü§ù' : (data.winner === mySymbol ? '–ü–æ–±–µ–¥–∞! üéâ' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢')) : (isMyTurn ? '–í–∞—à —Ö–æ–¥!' : '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...')}</p>                    </div>                    <div class="grid grid-cols-3 gap-3 max-w-xs mx-auto">                        ${data.board.map((cell, i) => `                            <button onclick="tttMove(${i})" class="aspect-square glass rounded-xl text-5xl font-bold hover:bg-purple-500/30 transition-all ${cell || !isMyTurn || data.winner ? '' : 'hover:scale-105'}">${cell === 'X' ? '‚ùå' : cell === 'O' ? '‚≠ï' : ''}</button>                        `).join('')}                    </div>                `;            }                        window.tttMove = async function(i) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.board[i] || data.turn !== mySymbol || data.winner) return;                                data.board[i] = mySymbol;                const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];                let winner = null;                for (const [a,b,c] of wins) {                    if (data.board[a] && data.board[a] === data.board[b] && data.board[a] === data.board[c]) {                        winner = data.board[a];                        break;                    }                }                if (!winner && !data.board.includes('')) winner = 'draw';                                await db.ref('games/' + gameId).update({                    board: data.board,                    turn: mySymbol === 'X' ? 'O' : 'X',                    winner: winner                });            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val()));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        async function initMultiplayerRPS(gameId) {            document.getElementById('gameTitle').textContent = '‚úä‚úã‚úåÔ∏è –ö–∞–º–µ–Ω—å-–ù–æ–∂–Ω–∏—Ü—ã-–ë—É–º–∞–≥–∞';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        function render(data) {                const myChoice = isPlayer1 ? data.choice1 : data.choice2;                const oppChoice = isPlayer1 ? data.choice2 : data.choice1;                const emoji = { rock: '‚úä', paper: '‚úã', scissors: '‚úåÔ∏è' };                                let result = null;                if (myChoice && oppChoice) {                    if (myChoice === oppChoice) result = 'draw';                    else if ((myChoice === 'rock' && oppChoice === 'scissors') ||                              (myChoice === 'paper' && oppChoice === 'rock') ||                              (myChoice === 'scissors' && oppChoice === 'paper')) result = 'win';                    else result = 'lose';                }                                document.getElementById('gameContent').innerHTML = `                    <div class="text-center">                        ${!myChoice ? `                            <p class="text-xl mb-6">–°–¥–µ–ª–∞–π—Ç–µ –≤—ã–±–æ—Ä!</p>                            <div class="flex justify-center gap-6 mb-8">                                <button onclick="rpsChoice('rock')" class="text-7xl p-6 glass rounded-2xl hover:bg-purple-500/30 hover:scale-110 transition-all">‚úä</button>                                <button onclick="rpsChoice('paper')" class="text-7xl p-6 glass rounded-2xl hover:bg-purple-500/30 hover:scale-110 transition-all">‚úã</button>                                <button onclick="rpsChoice('scissors')" class="text-7xl p-6 glass rounded-2xl hover:bg-purple-500/30 hover:scale-110 transition-all">‚úåÔ∏è</button>                            </div>                        ` : result ? `                            <div class="flex justify-center gap-12 mb-6">                                <div>                                    <p class="text-gray-300 mb-2">–í—ã</p>                                    <div class="text-7xl">${emoji[myChoice]}</div>                                </div>                                <div class="text-4xl self-center">‚öîÔ∏è</div>                                <div>                                    <p class="text-gray-300 mb-2">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</p>                                    <div class="text-7xl">${emoji[oppChoice]}</div>                                </div>                            </div>                            <p class="text-3xl font-bold ${result === 'win' ? 'text-green-400' : result === 'lose' ? 'text-red-400' : 'text-yellow-400'}">${result === 'win' ? '–ü–æ–±–µ–¥–∞! üéâ' : result === 'lose' ? '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢' : '–ù–∏—á—å—è! ü§ù'}</p>                        ` : `                            <div class="text-7xl mb-4">${emoji[myChoice]}</div>                            <p class="text-xl">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>                        `}                    </div>                `;            }                        window.rpsChoice = async function(choice) {                const field = isPlayer1 ? 'choice1' : 'choice2';                await db.ref('games/' + gameId + '/' + field).set(choice);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val() || {}));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        async function initMultiplayerClickBattle(gameId) {            document.getElementById('gameTitle').textContent = 'üëÜ –ö–ª–∏–∫–µ—Ä-–ë–∞—Ç–ª';            const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        if (isPlayer1 && !game.startTime) {                await db.ref('games/' + gameId).update({ clicks1: 0, clicks2: 0, startTime: Date.now(), duration: 10000 });            }                        let localClicks = 0;                        function render(data) {                const myClicks = isPlayer1 ? data.clicks1 : data.clicks2;                const oppClicks = isPlayer1 ? data.clicks2 : data.clicks1;                const timeLeft = Math.max(0, Math.ceil(((data.duration || 10000) - (Date.now() - data.startTime)) / 1000));                                if (timeLeft <= 0) {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="flex justify-center gap-8 mb-4">                                <div><p class="text-gray-300">–í—ã</p><p class="text-4xl font-bold">${localClicks}</p></div>                                <div><p class="text-gray-300">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</p><p class="text-4xl font-bold">${oppClicks}</p></div>                            </div>                            <p class="text-2xl font-bold ${localClicks > oppClicks ? 'text-green-400' : localClicks < oppClicks ? 'text-red-400' : 'text-yellow-400'}">                                ${localClicks > oppClicks ? '–ü–æ–±–µ–¥–∞! üéâ' : localClicks < oppClicks ? '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢' : '–ù–∏—á—å—è! ü§ù'}                            </p>                        </div>                    `;                    return;                }                                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-6">                        <p class="text-5xl font-bold mb-4">‚è±Ô∏è ${timeLeft}</p>                        <div class="flex justify-center gap-8">                            <p>–í—ã: <span class="font-bold text-green-400">${localClicks}</span></p>                            <p>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: <span class="font-bold text-red-400">${oppClicks}</span></p>                        </div>                    </div>                    <button onclick="clickBattle()" class="w-48 h-48 mx-auto block glass rounded-full text-8xl hover:scale-105 active:scale-95 transition-transform pulse-glow">üëÜ</button>                `;            }                        window.clickBattle = async function() {                localClicks++;                const field = isPlayer1 ? 'clicks1' : 'clicks2';                await db.ref('games/' + gameId + '/' + field).set(localClicks);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val() || {}));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        async function initMultiplayerMathBattle(gameId) {            document.getElementById('gameTitle').textContent = 'üî¢ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±–æ–π';            const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        if (isPlayer1 && !game.problems) {                const problems = [];                for (let i = 0; i < 10; i++) {                    const a = Math.floor(Math.random() * 15) + 1;                    const b = Math.floor(Math.random() * 15) + 1;                    const ops = ['+', '-', '√ó'];                    const op = ops[Math.floor(Math.random() * 3)];                    let answer = op === '+' ? a + b : op === '-' ? a - b : a * b;                    const options = [answer];                    while (options.length < 4) {                        const wrong = answer + Math.floor(Math.random() * 20) - 10;                        if (!options.includes(wrong)) options.push(wrong);                    }                    problems.push({ q: `${a} ${op} ${b}`, answer, options: options.sort(() => Math.random() - 0.5) });                }                await db.ref('games/' + gameId).update({ problems, current1: 0, current2: 0, score1: 0, score2: 0 });            }                        function render(data) {                if (!data.problems) return;                const myCurrent = isPlayer1 ? data.current1 : data.current2;                const oppCurrent = isPlayer1 ? data.current2 : data.current1;                const myScore = isPlayer1 ? data.score1 : data.score2;                const oppScore = isPlayer1 ? data.score2 : data.score1;                                if (myCurrent >= 10 || oppCurrent >= 10) {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="flex justify-center gap-8 mb-4">                                <div><p class="text-gray-300">–í—ã</p><p class="text-4xl font-bold">${myScore}/10</p></div>                                <div><p class="text-gray-300">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</p><p class="text-4xl font-bold">${oppScore}/10</p></div>                            </div>                            <p class="text-2xl font-bold ${myScore > oppScore ? 'text-green-400' : myScore < oppScore ? 'text-red-400' : 'text-yellow-400'}">                                ${myScore > oppScore ? '–ü–æ–±–µ–¥–∞! üéâ' : myScore < oppScore ? '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢' : '–ù–∏—á—å—è! ü§ù'}                            </p>                        </div>                    `;                    return;                }                                const p = data.problems[myCurrent];                document.getElementById('gameContent').innerHTML = `                    <div class="flex justify-between mb-4">                        <p>–í—ã: ${myCurrent + 1}/10</p>                        <p>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: ${oppCurrent + 1}/10</p>                    </div>                    <p class="text-4xl font-bold text-center mb-6 gradient-text">${p.q} = ?</p>                    <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">                        ${p.options.map(o => `<button onclick="mathAnswer(${o})" class="glass p-4 rounded-xl text-2xl font-bold hover:bg-purple-500/50">${o}</button>`).join('')}                    </div>                `;            }                        window.mathAnswer = async function(ans) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                const myCurrent = isPlayer1 ? data.current1 : data.current2;                const updates = { [isPlayer1 ? 'current1' : 'current2']: myCurrent + 1 };                if (ans === data.problems[myCurrent].answer) {                    updates[isPlayer1 ? 'score1' : 'score2'] = (isPlayer1 ? data.score1 : data.score2) + 1;                }                await db.ref('games/' + gameId).update(updates);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val() || {}));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        async function initMultiplayerQuiz(gameId) {            document.getElementById('gameTitle').textContent = 'üß© –í–∏–∫—Ç–æ—Ä–∏–Ω–∞';            const questions = [                {q: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?", a: ["–ü–∞—Ä–∏–∂", "–õ–æ–Ω–¥–æ–Ω", "–ë–µ—Ä–ª–∏–Ω", "–ú–∞–¥—Ä–∏–¥"], c: 0},                {q: "–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø–ª–∞–Ω–µ—Ç–∞?", a: ["–Æ–ø–∏—Ç–µ—Ä", "–°–∞—Ç—É—Ä–Ω", "–ó–µ–º–ª—è", "–ú–∞—Ä—Å"], c: 0},                {q: "–°–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–æ–≤?", a: ["7", "6", "5", "8"], c: 0},                {q: "–•–∏–º–∏—á–µ—Å–∫–∏–π —Å–∏–º–≤–æ–ª –≤–æ–¥—ã?", a: ["H2O", "CO2", "O2", "NaCl"], c: 0},                {q: "–°—Ç–æ–ª–∏—Ü–∞ –Ø–ø–æ–Ω–∏–∏?", a: ["–¢–æ–∫–∏–æ", "–ü–µ–∫–∏–Ω", "–°–µ—É–ª", "–ë–∞–Ω–≥–∫–æ–∫"], c: 0},            ];                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        if (!game.questions) {                await db.ref('games/' + gameId).update({ questions, current: 0, score1: 0, score2: 0, answer1: null, answer2: null });            }                        function render(data) {                if (!data.questions) return;                const myScore = isPlayer1 ? data.score1 : data.score2;                const oppScore = isPlayer1 ? data.score2 : data.score1;                                if (data.current >= data.questions.length) {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="flex justify-center gap-8 mb-4">                                <div><p class="text-gray-300">–í—ã</p><p class="text-4xl font-bold">${myScore}</p></div>                                <div><p class="text-gray-300">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</p><p class="text-4xl font-bold">${oppScore}</p></div>                            </div>                            <p class="text-2xl font-bold ${myScore > oppScore ? 'text-green-400' : myScore < oppScore ? 'text-red-400' : 'text-yellow-400'}">                                ${myScore > oppScore ? '–ü–æ–±–µ–¥–∞! üéâ' : myScore < oppScore ? '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢' : '–ù–∏—á—å—è! ü§ù'}                            </p>                        </div>                    `;                    return;                }                                const q = data.questions[data.current];                const myAnswer = isPlayer1 ? data.answer1 : data.answer2;                                document.getElementById('gameContent').innerHTML = `                    <div class="flex justify-between mb-4"><p>–í—ã: ${myScore}</p><p>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: ${oppScore}</p></div>                    <p class="text-center text-gray-300 mb-2">–í–æ–ø—Ä–æ—Å ${data.current + 1}/${data.questions.length}</p>                    <p class="text-2xl font-bold text-center mb-6">${q.q}</p>                    ${myAnswer !== null ? '<p class="text-center text-gray-300">–û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...</p>' : `                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">                            ${q.a.map((a, i) => `<button onclick="quizAnswer(${i})" class="glass p-4 rounded-xl text-lg font-bold hover:bg-purple-500/50">${a}</button>`).join('')}                        </div>                    `}                `;            }                        window.quizAnswer = async function(i) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                const answerField = isPlayer1 ? 'answer1' : 'answer2';                const scoreField = isPlayer1 ? 'score1' : 'score2';                const updates = { [answerField]: i };                if (i === data.questions[data.current].c) updates[scoreField] = (isPlayer1 ? data.score1 : data.score2) + 1;                await db.ref('games/' + gameId).update(updates);                                setTimeout(async () => {                    const s = await db.ref('games/' + gameId).once('value');                    const d = s.val();                    if (d.answer1 !== null && d.answer2 !== null) {                        await db.ref('games/' + gameId).update({ current: d.current + 1, answer1: null, answer2: null });                    }                }, 1000);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val() || {}));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        async function initMultiplayerWordChain(gameId) {            document.getElementById('gameTitle').textContent = 'üìù –°–ª–æ–≤–∞';            const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        if (!game.words) {                await db.ref('games/' + gameId).update({ words: [], turn: 1, lastLetter: '' });            }                        function render(data) {                const isMyTurn = (data.turn === 1 && isPlayer1) || (data.turn === 2 && !isPlayer1);                const words = data.words || [];                                if (data.winner) {                    const iWon = (data.winner === 1 && isPlayer1) || (data.winner === 2 && !isPlayer1);                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <p class="text-3xl font-bold ${iWon ? 'text-green-400' : 'text-red-400'}">${iWon ? '–ü–æ–±–µ–¥–∞! üéâ' : '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ üò¢'}</p>                            <p class="text-gray-300 mt-2">–°–ª–æ–≤: ${words.length}</p>                        </div>                    `;                    return;                }                                document.getElementById('gameContent').innerHTML = `                    <p class="text-center text-xl mb-2 ${isMyTurn ? 'text-green-400' : 'text-gray-400'}">${isMyTurn ? '–í–∞—à —Ö–æ–¥!' : '–•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...'}</p>                    ${data.lastLetter ? `<p class="text-center mb-4">–ù–∞—á–Ω–∏—Ç–µ –Ω–∞: <span class="text-3xl font-bold gradient-text">${data.lastLetter.toUpperCase()}</span></p>` : ''}                    <div class="glass rounded-xl p-4 mb-4 max-h-32 overflow-y-auto">                        ${words.length ? words.map((w, i) => `<span class="${i % 2 ? 'text-pink-400' : 'text-purple-400'}">${w}</span>`).join(' ‚Üí ') : '<p class="text-gray-400 text-center">–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ</p>'}                    </div>                    ${isMyTurn ? `                        <div class="flex gap-2">                            <input type="text" id="wordInput" placeholder="–°–ª–æ–≤–æ..." class="flex-1 p-4 rounded-xl bg-white/10 border border-white/20" onkeypress="if(event.key==='Enter')submitWord()">                            <button onclick="submitWord()" class="btn-primary px-6 rounded-xl font-bold">‚Üí</button>                        </div>                        <button onclick="giveUp()" class="w-full mt-4 glass p-3 rounded-xl text-red-400 hover:bg-red-500/20">–°–¥–∞—Ç—å—Å—è üè≥Ô∏è</button>                    ` : ''}                `;            }                        window.submitWord = async function() {                const word = document.getElementById('wordInput').value.trim().toLowerCase();                if (!word) return;                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.lastLetter && word[0] !== data.lastLetter) { notify('–ù–∞—á–Ω–∏—Ç–µ –Ω–∞ ' + data.lastLetter.toUpperCase()); return; }                if (data.words?.includes(word)) { notify('–°–ª–æ–≤–æ —É–∂–µ –±—ã–ª–æ!'); return; }                await db.ref('games/' + gameId).update({                    words: [...(data.words || []), word],                    lastLetter: word[word.length - 1],                    turn: data.turn === 1 ? 2 : 1                });            };                        window.giveUp = async function() {                const snap = await db.ref('games/' + gameId).once('value');                await db.ref('games/' + gameId + '/winner').set(snap.val().turn === 1 ? 2 : 1);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val() || {}));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        async function initMultiplayerColorMatch(gameId) {            document.getElementById('gameTitle').textContent = 'üé® –¶–≤–µ—Ç–æ–≤–∞—è –≥–æ–Ω–∫–∞';            const colors = [                { name: '–ö—Ä–∞—Å–Ω—ã–π', color: '#ef4444' }, { name: '–°–∏–Ω–∏–π', color: '#3b82f6' },                { name: '–ó–µ–ª—ë–Ω—ã–π', color: '#22c55e' }, { name: '–ñ—ë–ª—Ç—ã–π', color: '#eab308' },                { name: '–§–∏–æ–ª–µ—Ç', color: '#a855f7' }, { name: '–û—Ä–∞–Ω–∂', color: '#f97316' }            ];                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        if (isPlayer1 && !game.rounds) {                const rounds = Array(10).fill().map(() => {                    const correct = colors[Math.floor(Math.random() * colors.length)];                    const display = colors[Math.floor(Math.random() * colors.length)];                    return { text: correct.name, displayColor: display.color, correctColor: correct.color };                });                await db.ref('games/' + gameId).update({ rounds, current1: 0, current2: 0, score1: 0, score2: 0 });            }                        function render(data) {                if (!data.rounds) return;                const myCurrent = isPlayer1 ? data.current1 : data.current2;                const myScore = isPlayer1 ? data.score1 : data.score2;                const oppScore = isPlayer1 ? data.score2 : data.score1;                                if (myCurrent >= 10) {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="flex justify-center gap-8 mb-4">                                <div><p class="text-gray-300">–í—ã</p><p class="text-4xl font-bold">${myScore}/10</p></div>                                <div><p class="text-gray-300">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</p><p class="text-4xl font-bold">${oppScore}/10</p></div>                            </div>                            <p class="text-2xl font-bold ${myScore > oppScore ? 'text-green-400' : myScore < oppScore ? 'text-red-400' : 'text-yellow-400'}">                                ${myScore > oppScore ? '–ü–æ–±–µ–¥–∞!' : myScore < oppScore ? '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!' : '–ù–∏—á—å—è!'}                            </p>                        </div>                    `;                    return;                }                                const r = data.rounds[myCurrent];                document.getElementById('gameContent').innerHTML = `                    <p class="text-center text-gray-300 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –¢–ï–ö–°–¢–ê (${myCurrent + 1}/10)</p>                    <p class="text-5xl font-black text-center mb-6" style="color:${r.displayColor}">${r.text}</p>                    <div class="grid grid-cols-3 gap-3 max-w-sm mx-auto">                        ${colors.map(c => `<button onclick="colorAnswer('${c.color}')" class="aspect-square rounded-xl hover:scale-105 transition-transform" style="background:${c.color}"></button>`).join('')}                    </div>                `;            }                        window.colorAnswer = async function(color) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                const myCurrent = isPlayer1 ? data.current1 : data.current2;                const updates = { [isPlayer1 ? 'current1' : 'current2']: myCurrent + 1 };                if (color === data.rounds[myCurrent].correctColor) {                    updates[isPlayer1 ? 'score1' : 'score2'] = (isPlayer1 ? data.score1 : data.score2) + 1;                }                await db.ref('games/' + gameId).update(updates);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => render(snap.val() || {}));            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // ==================== SOLO GAMES ====================                function initFruitCatcherSolo() {            document.getElementById('gameTitle').textContent = 'üß∫ –õ–æ–≤–µ—Ü —Ñ—Ä—É–∫—Ç–æ–≤';            let score = 0, timeLeft = 30, basketPos = 50, fruits = [], gameOver = false;            const fruitEmojis = ['üçé', 'üçä', 'üçã', 'üçá', 'üçì', 'üçë', 'üçí', 'ü•ù', 'üçå', 'üçâ'];                        function render() {                document.getElementById('gameContent').innerHTML = `                    <div class="flex justify-between mb-4">                        <p class="text-xl font-bold">üçé ${score}</p>                        <p class="text-xl font-bold">‚è±Ô∏è ${timeLeft}—Å</p>                    </div>                    <div id="soloFruitArea" class="relative bg-gradient-to-b from-sky-900/50 to-green-900/50 rounded-2xl h-72 overflow-hidden">                        <div id="soloFruits"></div>                        <div id="soloBasket" class="absolute bottom-2 text-5xl" style="left:${basketPos}%;transform:translateX(-50%)">üß∫</div>                    </div>                    <div class="flex justify-center gap-4 mt-4">                        <button onmousedown="soloMoveStart(-1)" onmouseup="soloMoveStop()" onmouseleave="soloMoveStop()" ontouchstart="soloMoveStart(-1)" ontouchend="soloMoveStop()" class="glass px-10 py-4 rounded-xl text-3xl">‚¨ÖÔ∏è</button>                        <button onmousedown="soloMoveStart(1)" onmouseup="soloMoveStop()" onmouseleave="soloMoveStop()" ontouchstart="soloMoveStart(1)" ontouchend="soloMoveStop()" class="glass px-10 py-4 rounded-xl text-3xl">‚û°Ô∏è</button>                    </div>                    ${gameOver ? `<div class="text-center mt-6"><p class="text-2xl font-bold gradient-text">–°—á—ë—Ç: ${score}</p><button onclick="initFruitCatcherSolo()" class="btn-primary px-6 py-3 rounded-xl font-bold mt-4">üîÑ –ï—â—ë —Ä–∞–∑</button></div>` : ''}                `;            }                        let moveInt = null;            window.soloMoveStart = (d) => { soloMoveStop(); moveInt = setInterval(() => { basketPos = Math.max(8, Math.min(92, basketPos + d * 4)); document.getElementById('soloBasket').style.left = basketPos + '%'; }, 30); };            window.soloMoveStop = () => { clearInterval(moveInt); };                        render();                        const spawnInt = setInterval(() => { if (!gameOver) fruits.push({ emoji: fruitEmojis[Math.floor(Math.random() * fruitEmojis.length)], x: Math.random() * 80 + 10, y: 0 }); }, 600);            const loopInt = setInterval(() => {                if (gameOver) return;                fruits.forEach(f => f.y += 2.5);                fruits = fruits.filter(f => {                    if (f.y >= 85 && f.y <= 100 && Math.abs(f.x - basketPos) < 12) { score++; return false; }                    return f.y < 100;                });                const el = document.getElementById('soloFruits');                if (el) el.innerHTML = fruits.map(f => `<div class="absolute text-3xl" style="left:${f.x}%;top:${f.y}%;transform:translateX(-50%)">${f.emoji}</div>`).join('');            }, 50);            const timerInt = setInterval(() => { timeLeft--; if (timeLeft <= 0) { gameOver = true; clearInterval(spawnInt); clearInterval(loopInt); clearInterval(timerInt); saveScore('fruitcatcher', score); render(); } else { const t = document.querySelector('.text-xl.font-bold:last-child'); if (t) t.textContent = `‚è±Ô∏è ${timeLeft}—Å`; } }, 1000);                        gameIntervals.push(spawnInt, loopInt, timerInt);        }        function initMemory() {            document.getElementById('gameTitle').textContent = 'üß† –ú–µ–º–æ—Ä–∏';            const emojis = ['üéÆ', 'üé≤', 'üéØ', 'üé™', 'üé®', 'üé≠', 'üé∏', 'üé∫'];            let cards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);            let flipped = [], matched = [], moves = 0, startTime = Date.now();                        function render() {                document.getElementById('gameContent').innerHTML = `                    <p class="text-center mb-4">–•–æ–¥—ã: ${moves} | –ù–∞–π–¥–µ–Ω–æ: ${matched.length / 2}/${emojis.length}</p>                    <div class="grid grid-cols-4 gap-2 max-w-sm mx-auto">                        ${cards.map((e, i) => `                            <div onclick="flipCard(${i})" class="aspect-square cursor-pointer glass rounded-xl flex items-center justify-center text-3xl ${flipped.includes(i) || matched.includes(i) ? (matched.includes(i) ? 'bg-green-500/30' : 'bg-purple-500/30') : 'hover:bg-white/20'}">                                ${flipped.includes(i) || matched.includes(i) ? e : '‚ùì'}                            </div>                        `).join('')}                    </div>                    ${matched.length === cards.length ? `<div class="text-center mt-6"><p class="text-2xl font-bold text-green-400">–ü–æ–±–µ–¥–∞! üéâ</p><p class="text-gray-300">–í—Ä–µ–º—è: ${Math.round((Date.now() - startTime) / 1000)}—Å</p><button onclick="initMemory()" class="btn-primary px-6 py-3 rounded-xl font-bold mt-4">üîÑ –ï—â—ë</button></div>` : ''}                `;            }                        window.flipCard = (i) => {                if (flipped.length >= 2 || flipped.includes(i) || matched.includes(i)) return;                flipped.push(i);                render();                if (flipped.length === 2) {                    moves++;                    if (cards[flipped[0]] === cards[flipped[1]]) {                        matched.push(...flipped);                        flipped = [];                        render();                        if (matched.length === cards.length) saveScore('memory', 10000 - Math.round((Date.now() - startTime) / 100) - moves * 50);                    } else {                        setTimeout(() => { flipped = []; render(); }, 1000);                    }                }            };            render();        }        function initReaction() {            document.getElementById('gameTitle').textContent = '‚ö° –†–µ–∞–∫—Ü–∏—è';            let state = 'waiting', startTime = 0, timeout = null;                        function render() {                const contents = {                    waiting: `<div onclick="startReaction()" class="aspect-video glass rounded-2xl flex items-center justify-center cursor-pointer bg-blue-500/30 hover:bg-blue-500/50"><div class="text-center"><div class="text-6xl mb-4">üëÜ</div><p class="text-xl">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p></div></div>`,                    ready: `<div onclick="tooEarly()" class="aspect-video glass rounded-2xl flex items-center justify-center cursor-pointer bg-red-500/30"><div class="text-center"><div class="text-6xl mb-4">‚è≥</div><p class="text-xl">–ñ–¥–∏—Ç–µ –∑–µ–ª—ë–Ω—ã–π...</p></div></div>`,                    go: `<div onclick="clickReaction()" class="aspect-video glass rounded-2xl flex items-center justify-center cursor-pointer bg-green-500/50 animate-pulse"><div class="text-center"><div class="text-6xl mb-4">‚ö°</div><p class="text-xl font-bold">–ñ–ú–ò–¢–ï!</p></div></div>`,                    result: `<div class="text-center py-8"><div class="text-6xl mb-4">‚ö°</div><p class="text-4xl font-bold gradient-text mb-2">${Date.now() - startTime} –º—Å</p><button onclick="initReaction()" class="btn-primary px-6 py-3 rounded-xl font-bold mt-4">üîÑ –ï—â—ë</button></div>`,                    early: `<div class="text-center py-8"><div class="text-6xl mb-4">üòÖ</div><p class="text-2xl font-bold text-red-400">–†–∞–Ω–æ!</p><button onclick="initReaction()" class="btn-primary px-6 py-3 rounded-xl font-bold mt-4">üîÑ –ï—â—ë</button></div>`                };                document.getElementById('gameContent').innerHTML = contents[state];                if (state === 'result') saveScore('reaction', Math.max(0, 1000 - (Date.now() - startTime)));            }                        window.startReaction = () => { state = 'ready'; render(); timeout = setTimeout(() => { state = 'go'; startTime = Date.now(); render(); }, Math.random() * 3000 + 1000); };            window.tooEarly = () => { clearTimeout(timeout); state = 'early'; render(); };            window.clickReaction = () => { state = 'result'; render(); };            render();        }        function initSnake() {            document.getElementById('gameTitle').textContent = 'üêç –ó–º–µ–π–∫–∞';            const size = 12;            let snake = [{ x: 6, y: 6 }], food = { x: 3, y: 3 }, dir = { x: 1, y: 0 }, score = 0, gameOver = false;                        function placeFood() { do { food = { x: Math.floor(Math.random() * size), y: Math.floor(Math.random() * size) }; } while (snake.some(s => s.x === food.x && s.y === food.y)); }                        function render() {                let grid = '';                for (let y = 0; y < size; y++) for (let x = 0; x < size; x++) {                    const isHead = snake[0].x === x && snake[0].y === y;                    const isSnake = snake.some(s => s.x === x && s.y === y);                    const isFood = food.x === x && food.y === y;                    grid += `<div class="aspect-square rounded-sm ${isHead ? 'bg-green-400' : isSnake ? 'bg-green-600' : isFood ? 'bg-red-500' : 'bg-white/10'}"></div>`;                }                document.getElementById('gameContent').innerHTML = `                    <p class="text-center text-xl font-bold mb-4">üçé ${score}</p>                    <div class="grid gap-0.5 max-w-xs mx-auto" style="grid-template-columns:repeat(${size},1fr)">${grid}</div>                    ${gameOver ? `<div class="text-center mt-6"><p class="text-2xl font-bold text-red-400">Game Over!</p><button onclick="initSnake()" class="btn-primary px-6 py-3 rounded-xl font-bold mt-4">üîÑ –ï—â—ë</button></div>` : `                    <div class="flex flex-col items-center gap-2 mt-4">                        <button onclick="snakeDir(0,-1)" class="glass px-6 py-2 rounded-xl text-xl">‚¨ÜÔ∏è</button>                        <div class="flex gap-2"><button onclick="snakeDir(-1,0)" class="glass px-6 py-2 rounded-xl text-xl">‚¨ÖÔ∏è</button><button onclick="snakeDir(0,1)" class="glass px-6 py-2 rounded-xl text-xl">‚¨áÔ∏è</button><button onclick="snakeDir(1,0)" class="glass px-6 py-2 rounded-xl text-xl">‚û°Ô∏è</button></div>                    </div>`}                `;            }                        function move() {                if (gameOver) return;                const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };                if (head.x < 0 || head.x >= size || head.y < 0 || head.y >= size || snake.some(s => s.x === head.x && s.y === head.y)) {                    gameOver = true; saveScore('snake', score); render(); return;                }                snake.unshift(head);                if (head.x === food.x && head.y === food.y) { score += 10; placeFood(); } else snake.pop();                render();            }                        window.snakeDir = (x, y) => { if ((x && dir.x) || (y && dir.y)) return; dir = { x, y }; };            document.onkeydown = (e) => { if (e.key === 'ArrowUp') snakeDir(0, -1); if (e.key === 'ArrowDown') snakeDir(0, 1); if (e.key === 'ArrowLeft') snakeDir(-1, 0); if (e.key === 'ArrowRight') snakeDir(1, 0); };                        const interval = setInterval(move, 150);            gameIntervals.push(interval);            render();        }        // ==================== LEADERBOARD & UTILS ====================                async function saveScore(game, score) {            if (!currentUser || score <= 0) return;            const userData = await db.ref('users/' + currentUser.uid).once('value');            const username = userData.val()?.username || '–ò–≥—Ä–æ–∫';            const existing = await db.ref('leaderboard/' + game).orderByChild('userId').equalTo(currentUser.uid).once('value');            const data = existing.val();            if (data) {                const key = Object.keys(data)[0];                if (data[key].score < score) await db.ref('leaderboard/' + game + '/' + key + '/score').set(score);            } else {                await db.ref('leaderboard/' + game).push({ userId: currentUser.uid, username, score });            }        }        async function showLeaderboard(game) {            document.querySelectorAll('.lb-btn').forEach(b => b.classList.remove('bg-purple-500'));            event.target.classList.add('bg-purple-500');            const snap = await db.ref('leaderboard/' + game).orderByChild('score').limitToLast(10).once('value');            const entries = Object.values(snap.val() || {}).sort((a, b) => b.score - a.score);            const medals = ['ü•á', 'ü•à', 'ü•â'];            document.getElementById('leaderboardList').innerHTML = entries.length ? entries.map((e, i) => `                <div class="flex items-center justify-between bg-white/10 rounded-xl p-4 ${e.userId === currentUser?.uid ? 'ring-2 ring-purple-500' : ''}">                    <div class="flex items-center gap-3"><span class="text-2xl">${medals[i] || (i + 1)}</span><span class="font-bold">${e.username}</span></div>                    <span class="text-xl font-bold gradient-text">${e.score}</span>                </div>            `).join('') : '<p class="text-gray-400 text-center">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</p>';        }        function notify(text) {            const el = document.getElementById('notification');            document.getElementById('notificationText').textContent = text;            el.classList.remove('hidden', 'translate-y-20');            setTimeout(() => { el.classList.add('translate-y-20'); setTimeout(() => el.classList.add('hidden'), 300); }, 3000);        }        showSection('games');    </script></body></html>