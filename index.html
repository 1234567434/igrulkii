<!DOCTYPE html><html lang="ru"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>?? GameZone - Игровой Портал</title>    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">    <style>        * { font-family: 'Nunito', sans-serif; }                body {            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);            min-height: 100vh;        }                .glass {            background: rgba(255, 255, 255, 0.1);            backdrop-filter: blur(20px);            border: 1px solid rgba(255, 255, 255, 0.2);        }                .neon-glow {            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5), 0 0 40px rgba(139, 92, 246, 0.3);        }                .game-card {            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);        }                .game-card:hover {            transform: translateY(-10px) scale(1.02);            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.4);        }                .floating {            animation: floating 3s ease-in-out infinite;        }                @keyframes floating {            0%, 100% { transform: translateY(0); }            50% { transform: translateY(-10px); }        }                .pulse-glow {            animation: pulseGlow 2s ease-in-out infinite;        }                @keyframes pulseGlow {            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.5); }            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.8), 0 0 60px rgba(236, 72, 153, 0.4); }        }                .gradient-text {            background: linear-gradient(135deg, #8b5cf6, #ec4899, #06b6d4);            -webkit-background-clip: text;            -webkit-text-fill-color: transparent;            background-clip: text;        }                .btn-primary {            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);            transition: all 0.3s ease;        }                .btn-primary:hover {            transform: scale(1.05);            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);        }                .online-dot {            animation: onlinePulse 2s infinite;        }                @keyframes onlinePulse {            0%, 100% { opacity: 1; }            50% { opacity: 0.5; }        }                .particle {            position: fixed;            pointer-events: none;            border-radius: 50%;            animation: floatUp 15s linear infinite;        }                @keyframes floatUp {            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }            10% { opacity: 1; }            90% { opacity: 1; }            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }        }                .memory-card {            perspective: 1000px;        }                .memory-card-inner {            transition: transform 0.6s;            transform-style: preserve-3d;        }                .memory-card.flipped .memory-card-inner {            transform: rotateY(180deg);        }                .memory-card-front, .memory-card-back {            backface-visibility: hidden;        }                .memory-card-back {            transform: rotateY(180deg);        }                .shake {            animation: shake 0.5s ease-in-out;        }                @keyframes shake {            0%, 100% { transform: translateX(0); }            25% { transform: translateX(-5px); }            75% { transform: translateX(5px); }        }        .slide-in {            animation: slideIn 0.5s ease-out;        }        @keyframes slideIn {            from { opacity: 0; transform: translateY(20px); }            to { opacity: 1; transform: translateY(0); }        }        ::-webkit-scrollbar { width: 8px; }        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }        ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #8b5cf6, #ec4899); border-radius: 4px; }    </style></head><body class="text-white overflow-x-hidden">    <!-- Particles Background -->    <div id="particles"></div>    <!-- Auth Screen -->    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">        <div class="glass rounded-3xl p-8 w-full max-w-md neon-glow slide-in">            <div class="text-center mb-8">                <h1 class="text-5xl font-black gradient-text mb-2">?? GameZone</h1>                <p class="text-gray-300">Играй с друзьями онлайн!</p>            </div>                        <div id="authTabs" class="flex mb-6 bg-white/10 rounded-xl p-1">                <button onclick="showAuthTab('login')" id="loginTab" class="flex-1 py-2 rounded-lg bg-purple-500 font-bold transition-all">Вход</button>                <button onclick="showAuthTab('register')" id="registerTab" class="flex-1 py-2 rounded-lg font-bold transition-all">Регистрация</button>            </div>                        <div id="loginForm">                <input type="email" id="loginEmail" placeholder="Email" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <input type="password" id="loginPassword" placeholder="Пароль" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <button onclick="login()" class="w-full btn-primary py-4 rounded-xl font-bold text-lg">Войти ??</button>            </div>                        <div id="registerForm" class="hidden">                <input type="text" id="regUsername" placeholder="Никнейм" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <input type="email" id="regEmail" placeholder="Email" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <input type="password" id="regPassword" placeholder="Пароль" class="w-full p-4 rounded-xl bg-white/10 border border-white/20 mb-4 focus:outline-none focus:border-purple-500 transition-all">                <button onclick="register()" class="w-full btn-primary py-4 rounded-xl font-bold text-lg">Создать аккаунт ?</button>            </div>                        <p id="authError" class="text-red-400 text-center mt-4 hidden"></p>        </div>    </div>    <!-- Main App -->    <div id="mainApp" class="hidden">        <!-- Header -->        <header class="glass sticky top-0 z-50 px-6 py-4">            <div class="max-w-7xl mx-auto flex items-center justify-between">                <h1 class="text-2xl font-black gradient-text">?? GameZone</h1>                <div class="flex items-center gap-4">                    <div class="flex items-center gap-2">                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center font-bold" id="userAvatar">?</div>                        <span id="userName" class="font-bold hidden sm:block">Игрок</span>                    </div>                    <button onclick="logout()" class="glass px-4 py-2 rounded-xl hover:bg-white/20 transition-all">??</button>                </div>            </div>        </header>        <!-- Navigation -->        <nav class="flex justify-center gap-2 p-4 flex-wrap">            <button onclick="showSection('games')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all" data-section="games">?? Игры</button>            <button onclick="showSection('friends')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all" data-section="friends">?? Друзья</button>            <button onclick="showSection('leaderboard')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all" data-section="leaderboard">?? Рейтинг</button>            <button onclick="showSection('invites')" class="nav-btn px-6 py-3 rounded-xl glass font-bold hover:bg-purple-500/50 transition-all relative" data-section="invites">                ?? Приглашения                <span id="invitesBadge" class="absolute -top-2 -right-2 bg-red-500 text-xs w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>            </button>        </nav>        <!-- Games Section -->        <section id="gamesSection" class="max-w-7xl mx-auto p-6">            <h2 class="text-3xl font-black mb-6 gradient-text">?? Выбери игру</h2>            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">                <!-- Tic Tac Toe -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('tictactoe')">                    <div class="text-6xl mb-4 floating">??</div>                    <h3 class="text-2xl font-bold mb-2">Крестики-Нолики</h3>                    <p class="text-gray-300 mb-4">Классическая игра для двоих</p>                    <span class="inline-block bg-green-500/30 text-green-300 px-3 py-1 rounded-full text-sm">?? Мультиплеер</span>                </div>                                <!-- Rock Paper Scissors -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('rps')">                    <div class="text-6xl mb-4 floating">????</div>                    <h3 class="text-2xl font-bold mb-2">Камень-Ножницы-Бумага</h3>                    <p class="text-gray-300 mb-4">Быстрая дуэль!</p>                    <span class="inline-block bg-green-500/30 text-green-300 px-3 py-1 rounded-full text-sm">?? Мультиплеер</span>                </div>                                <!-- Memory Game -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('memory')">                    <div class="text-6xl mb-4 floating">??</div>                    <h3 class="text-2xl font-bold mb-2">Мемори</h3>                    <p class="text-gray-300 mb-4">Найди все пары!</p>                    <span class="inline-block bg-blue-500/30 text-blue-300 px-3 py-1 rounded-full text-sm">?? Рейтинг</span>                </div>                                <!-- Reaction Game -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('reaction')">                    <div class="text-6xl mb-4 floating">?</div>                    <h3 class="text-2xl font-bold mb-2">Реакция</h3>                    <p class="text-gray-300 mb-4">Проверь свою скорость!</p>                    <span class="inline-block bg-blue-500/30 text-blue-300 px-3 py-1 rounded-full text-sm">?? Рейтинг</span>                </div>                                <!-- Snake -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('snake')">                    <div class="text-6xl mb-4 floating">??</div>                    <h3 class="text-2xl font-bold mb-2">Змейка</h3>                    <p class="text-gray-300 mb-4">Классика аркад!</p>                    <span class="inline-block bg-blue-500/30 text-blue-300 px-3 py-1 rounded-full text-sm">?? Рейтинг</span>                </div>                                <!-- Quiz -->                <div class="game-card glass rounded-2xl p-6 cursor-pointer" onclick="openGame('quiz')">                    <div class="text-6xl mb-4 floating">??</div>                    <h3 class="text-2xl font-bold mb-2">Викторина</h3>                    <p class="text-gray-300 mb-4">Проверь свои знания!</p>                    <span class="inline-block bg-green-500/30 text-green-300 px-3 py-1 rounded-full text-sm">?? Мультиплеер</span>                </div>            </div>        </section>        <!-- Friends Section -->        <section id="friendsSection" class="max-w-4xl mx-auto p-6 hidden">            <h2 class="text-3xl font-black mb-6 gradient-text">?? Друзья</h2>                        <div class="glass rounded-2xl p-6 mb-6">                <h3 class="text-xl font-bold mb-4">? Добавить друга</h3>                <div class="flex gap-4">                    <input type="text" id="friendEmail" placeholder="Email друга" class="flex-1 p-4 rounded-xl bg-white/10 border border-white/20 focus:outline-none focus:border-purple-500">                    <button onclick="addFriend()" class="btn-primary px-6 rounded-xl font-bold">Добавить</button>                </div>            </div>                        <div class="glass rounded-2xl p-6 mb-6">                <h3 class="text-xl font-bold mb-4">?? Запросы в друзья</h3>                <div id="friendRequests" class="space-y-3">                    <p class="text-gray-400">Нет новых запросов</p>                </div>            </div>                        <div class="glass rounded-2xl p-6">                <h3 class="text-xl font-bold mb-4">?? Мои друзья</h3>                <div id="friendsList" class="space-y-3">                    <p class="text-gray-400">У вас пока нет друзей</p>                </div>            </div>        </section>        <!-- Leaderboard Section -->        <section id="leaderboardSection" class="max-w-4xl mx-auto p-6 hidden">            <h2 class="text-3xl font-black mb-6 gradient-text">?? Таблица лидеров</h2>                        <div class="flex gap-2 mb-6 flex-wrap">                <button onclick="showLeaderboard('snake')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">?? Змейка</button>                <button onclick="showLeaderboard('memory')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">?? Мемори</button>                <button onclick="showLeaderboard('reaction')" class="lb-btn px-4 py-2 rounded-xl glass font-bold">? Реакция</button>            </div>                        <div id="leaderboardContent" class="glass rounded-2xl p-6">                <div class="space-y-3" id="leaderboardList">                    <p class="text-gray-400 text-center">Выберите игру</p>                </div>            </div>        </section>        <!-- Invites Section -->        <section id="invitesSection" class="max-w-4xl mx-auto p-6 hidden">            <h2 class="text-3xl font-black mb-6 gradient-text">?? Приглашения в игры</h2>            <div id="gameInvites" class="glass rounded-2xl p-6 space-y-4">                <p class="text-gray-400 text-center">Нет активных приглашений</p>            </div>        </section>    </div>    <!-- Game Modal -->    <div id="gameModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">        <div class="glass rounded-3xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto neon-glow">            <div class="flex justify-between items-center mb-6">                <h2 id="gameTitle" class="text-2xl font-black gradient-text">Игра</h2>                <button onclick="closeGame()" class="text-3xl hover:scale-110 transition-transform">?</button>            </div>            <div id="gameContent"></div>        </div>    </div>    <!-- Notification -->    <div id="notification" class="fixed bottom-4 right-4 glass rounded-xl p-4 hidden transform translate-y-20 transition-all z-50">        <p id="notificationText"></p>    </div>    <script>        // Firebase Config        const firebaseConfig = {            apiKey: "AIzaSyBKDnOlEP4wb8YfZkJ-b5qVzbZmCBn6G3A",            authDomain: "bucktupogub-ae41a.firebaseapp.com",            databaseURL: "https://bucktupogub-ae41a-default-rtdb.firebaseio.com",            projectId: "bucktupogub-ae41a",            storageBucket: "bucktupogub-ae41a.firebasestorage.app",            messagingSenderId: "974220682292",            appId: "1:974220682292:web:16f3696389804f2f4a5661",            measurementId: "G-QTZ59V95LN"        };        firebase.initializeApp(firebaseConfig);        const auth = firebase.auth();        const db = firebase.database();                let currentUser = null;        let currentGameId = null;        let gameListeners = [];        // Create particles        function createParticles() {            const container = document.getElementById('particles');            const colors = ['#8b5cf6', '#ec4899', '#06b6d4', '#10b981'];            for (let i = 0; i < 20; i++) {                const particle = document.createElement('div');                particle.className = 'particle';                particle.style.left = Math.random() * 100 + '%';                particle.style.width = Math.random() * 10 + 5 + 'px';                particle.style.height = particle.style.width;                particle.style.background = colors[Math.floor(Math.random() * colors.length)];                particle.style.animationDelay = Math.random() * 15 + 's';                particle.style.opacity = Math.random() * 0.5 + 0.2;                container.appendChild(particle);            }        }        createParticles();        // Auth        function showAuthTab(tab) {            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');            document.getElementById('loginTab').classList.toggle('bg-purple-500', tab === 'login');            document.getElementById('registerTab').classList.toggle('bg-purple-500', tab === 'register');        }        async function login() {            const email = document.getElementById('loginEmail').value;            const password = document.getElementById('loginPassword').value;            try {                await auth.signInWithEmailAndPassword(email, password);            } catch (e) {                showAuthError(e.message);            }        }        async function register() {            const username = document.getElementById('regUsername').value;            const email = document.getElementById('regEmail').value;            const password = document.getElementById('regPassword').value;            try {                const cred = await auth.createUserWithEmailAndPassword(email, password);                await db.ref('users/' + cred.user.uid).set({                    username: username,                    email: email,                    createdAt: Date.now(),                    online: true                });            } catch (e) {                showAuthError(e.message);            }        }        function logout() {            if (currentUser) {                db.ref('users/' + currentUser.uid + '/online').set(false);            }            auth.signOut();        }        function showAuthError(msg) {            const el = document.getElementById('authError');            el.textContent = msg;            el.classList.remove('hidden');        }        auth.onAuthStateChanged(async (user) => {            if (user) {                currentUser = user;                const userData = await db.ref('users/' + user.uid).once('value');                const data = userData.val() || {};                                document.getElementById('userName').textContent = data.username || 'Игрок';                document.getElementById('userAvatar').textContent = (data.username || 'И')[0].toUpperCase();                                db.ref('users/' + user.uid + '/online').set(true);                db.ref('users/' + user.uid + '/online').onDisconnect().set(false);                                document.getElementById('authScreen').classList.add('hidden');                document.getElementById('mainApp').classList.remove('hidden');                                setupListeners();            } else {                currentUser = null;                document.getElementById('authScreen').classList.remove('hidden');                document.getElementById('mainApp').classList.add('hidden');            }        });        // Navigation        function showSection(section) {            ['games', 'friends', 'leaderboard', 'invites'].forEach(s => {                document.getElementById(s + 'Section').classList.add('hidden');            });            document.getElementById(section + 'Section').classList.remove('hidden');                        document.querySelectorAll('.nav-btn').forEach(btn => {                btn.classList.remove('bg-purple-500');                if (btn.dataset.section === section) btn.classList.add('bg-purple-500');            });        }        // Friends        async function addFriend() {            const email = document.getElementById('friendEmail').value.trim();            if (!email) return;                        const users = await db.ref('users').orderByChild('email').equalTo(email).once('value');            const data = users.val();                        if (!data) {                notify('Пользователь не найден ??');                return;            }                        const friendId = Object.keys(data)[0];            if (friendId === currentUser.uid) {                notify('Нельзя добавить себя в друзья ??');                return;            }                        await db.ref('friendRequests/' + friendId + '/' + currentUser.uid).set({                from: currentUser.uid,                timestamp: Date.now()            });                        document.getElementById('friendEmail').value = '';            notify('Запрос отправлен! ??');        }        async function acceptFriend(friendId) {            await db.ref('friends/' + currentUser.uid + '/' + friendId).set(true);            await db.ref('friends/' + friendId + '/' + currentUser.uid).set(true);            await db.ref('friendRequests/' + currentUser.uid + '/' + friendId).remove();            notify('Друг добавлен! ??');        }        async function declineFriend(friendId) {            await db.ref('friendRequests/' + currentUser.uid + '/' + friendId).remove();        }        function setupListeners() {            // Friend requests            db.ref('friendRequests/' + currentUser.uid).on('value', async (snap) => {                const requests = snap.val() || {};                const container = document.getElementById('friendRequests');                                if (Object.keys(requests).length === 0) {                    container.innerHTML = '<p class="text-gray-400">Нет новых запросов</p>';                    return;                }                                container.innerHTML = '';                for (const id of Object.keys(requests)) {                    const userData = await db.ref('users/' + id).once('value');                    const user = userData.val() || {};                    container.innerHTML += `                        <div class="flex items-center justify-between bg-white/10 rounded-xl p-4">                            <div class="flex items-center gap-3">                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center font-bold">${(user.username || '?')[0].toUpperCase()}</div>                                <span class="font-bold">${user.username || 'Игрок'}</span>                            </div>                            <div class="flex gap-2">                                <button onclick="acceptFriend('${id}')" class="bg-green-500 px-4 py-2 rounded-lg font-bold hover:bg-green-600">?</button>                                <button onclick="declineFriend('${id}')" class="bg-red-500 px-4 py-2 rounded-lg font-bold hover:bg-red-600">?</button>                            </div>                        </div>                    `;                }            });            // Friends list            db.ref('friends/' + currentUser.uid).on('value', async (snap) => {                const friends = snap.val() || {};                const container = document.getElementById('friendsList');                                if (Object.keys(friends).length === 0) {                    container.innerHTML = '<p class="text-gray-400">У вас пока нет друзей</p>';                    return;                }                                container.innerHTML = '';                for (const id of Object.keys(friends)) {                    const userData = await db.ref('users/' + id).once('value');                    const user = userData.val() || {};                    const online = user.online ? '<span class="w-3 h-3 bg-green-500 rounded-full online-dot"></span>' : '<span class="w-3 h-3 bg-gray-500 rounded-full"></span>';                    container.innerHTML += `                        <div class="flex items-center justify-between bg-white/10 rounded-xl p-4">                            <div class="flex items-center gap-3">                                ${online}                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center font-bold">${(user.username || '?')[0].toUpperCase()}</div>                                <span class="font-bold">${user.username || 'Игрок'}</span>                            </div>                            <button onclick="inviteToGame('${id}')" class="btn-primary px-4 py-2 rounded-lg font-bold ${user.online ? '' : 'opacity-50 cursor-not-allowed'}" ${user.online ? '' : 'disabled'}>?? Пригласить</button>                        </div>                    `;                }            });            // Game invites            db.ref('gameInvites/' + currentUser.uid).on('value', async (snap) => {                const invites = snap.val() || {};                const container = document.getElementById('gameInvites');                const keys = Object.keys(invites);                                document.getElementById('invitesBadge').classList.toggle('hidden', keys.length === 0);                document.getElementById('invitesBadge').textContent = keys.length;                                if (keys.length === 0) {                    container.innerHTML = '<p class="text-gray-400 text-center">Нет активных приглашений</p>';                    return;                }                                container.innerHTML = '';                for (const id of keys) {                    const invite = invites[id];                    const userData = await db.ref('users/' + invite.from).once('value');                    const user = userData.val() || {};                    const gameNames = { tictactoe: 'Крестики-Нолики', rps: 'Камень-Ножницы-Бумага', quiz: 'Викторина' };                    container.innerHTML += `                        <div class="flex items-center justify-between bg-white/10 rounded-xl p-4">                            <div>                                <div class="font-bold">${user.username || 'Игрок'}</div>                                <div class="text-gray-300">${gameNames[invite.game] || invite.game}</div>                            </div>                            <div class="flex gap-2">                                <button onclick="joinGame('${id}', '${invite.game}', '${invite.gameId}')" class="bg-green-500 px-4 py-2 rounded-lg font-bold hover:bg-green-600">Принять</button>                                <button onclick="declineInvite('${id}')" class="bg-red-500 px-4 py-2 rounded-lg font-bold hover:bg-red-600">Отклонить</button>                            </div>                        </div>                    `;                }            });        }        let selectedGameForInvite = null;                function inviteToGame(friendId) {            document.getElementById('gameContent').innerHTML = `                <div class="text-center">                    <h3 class="text-xl font-bold mb-6">Выберите игру для приглашения</h3>                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">                        <button onclick="sendGameInvite('${friendId}', 'tictactoe')" class="glass p-6 rounded-xl hover:bg-purple-500/50 transition-all">                            <div class="text-4xl mb-2">??</div>                            <div class="font-bold">Крестики-Нолики</div>                        </button>                        <button onclick="sendGameInvite('${friendId}', 'rps')" class="glass p-6 rounded-xl hover:bg-purple-500/50 transition-all">                            <div class="text-4xl mb-2">????</div>                            <div class="font-bold">Камень-Ножницы-Бумага</div>                        </button>                        <button onclick="sendGameInvite('${friendId}', 'quiz')" class="glass p-6 rounded-xl hover:bg-purple-500/50 transition-all">                            <div class="text-4xl mb-2">??</div>                            <div class="font-bold">Викторина</div>                        </button>                    </div>                </div>            `;            document.getElementById('gameTitle').textContent = '?? Пригласить друга';            document.getElementById('gameModal').classList.remove('hidden');        }        async function sendGameInvite(friendId, game) {            const gameId = db.ref('games').push().key;                        await db.ref('games/' + gameId).set({                type: game,                player1: currentUser.uid,                player2: friendId,                status: 'waiting',                createdAt: Date.now()            });                        await db.ref('gameInvites/' + friendId + '/' + Date.now()).set({                from: currentUser.uid,                game: game,                gameId: gameId            });                        closeGame();            notify('Приглашение отправлено! ??');                        // Wait for opponent            waitForOpponent(gameId, game);        }        function waitForOpponent(gameId, game) {            document.getElementById('gameContent').innerHTML = `                <div class="text-center py-12">                    <div class="text-6xl mb-4 floating">?</div>                    <h3 class="text-xl font-bold mb-2">Ожидание соперника...</h3>                    <p class="text-gray-300">Приглашение отправлено</p>                </div>            `;            document.getElementById('gameTitle').textContent = '?? Ожидание';            document.getElementById('gameModal').classList.remove('hidden');                        const listener = db.ref('games/' + gameId + '/status').on('value', (snap) => {                if (snap.val() === 'playing') {                    db.ref('games/' + gameId + '/status').off('value', listener);                    startMultiplayerGame(gameId, game);                }            });            gameListeners.push({ ref: 'games/' + gameId + '/status', callback: listener });        }        async function joinGame(inviteId, game, gameId) {            await db.ref('gameInvites/' + currentUser.uid + '/' + inviteId).remove();            await db.ref('games/' + gameId + '/status').set('playing');            startMultiplayerGame(gameId, game);        }        async function declineInvite(inviteId) {            await db.ref('gameInvites/' + currentUser.uid + '/' + inviteId).remove();        }        // Games        function openGame(game) {            document.getElementById('gameModal').classList.remove('hidden');                        switch(game) {                case 'tictactoe': initTicTacToe(); break;                case 'rps': initRPS(); break;                case 'memory': initMemory(); break;                case 'reaction': initReaction(); break;                case 'snake': initSnake(); break;                case 'quiz': initQuiz(); break;            }        }        function closeGame() {            document.getElementById('gameModal').classList.add('hidden');            gameListeners.forEach(l => db.ref(l.ref).off('value', l.callback));            gameListeners = [];            currentGameId = null;        }        // Multiplayer games        function startMultiplayerGame(gameId, game) {            currentGameId = gameId;            switch(game) {                case 'tictactoe': initMultiplayerTicTacToe(gameId); break;                case 'rps': initMultiplayerRPS(gameId); break;                case 'quiz': initMultiplayerQuiz(gameId); break;            }        }        // TIC TAC TOE        function initTicTacToe() {            document.getElementById('gameTitle').textContent = '?? Крестики-Нолики';            let board = ['', '', '', '', '', '', '', '', ''];            let currentPlayer = 'X';            let gameOver = false;                        function render() {                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-4">                        <p class="text-xl" id="tttStatus">Ход: ${currentPlayer === 'X' ? '?' : '?'}</p>                    </div>                    <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto">                        ${board.map((cell, i) => `                            <button onclick="tttMove(${i})" class="aspect-square glass rounded-xl text-4xl font-bold hover:bg-purple-500/30 transition-all ${cell ? 'cursor-not-allowed' : ''}">${cell === 'X' ? '?' : cell === 'O' ? '?' : ''}</button>                        `).join('')}                    </div>                    <div class="text-center mt-6">                        <button onclick="initTicTacToe()" class="btn-primary px-6 py-3 rounded-xl font-bold">?? Новая игра</button>                    </div>                `;            }                        window.tttMove = function(i) {                if (board[i] || gameOver) return;                board[i] = currentPlayer;                                const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];                for (const [a,b,c] of wins) {                    if (board[a] && board[a] === board[b] && board[a] === board[c]) {                        gameOver = true;                        render();                        document.getElementById('tttStatus').innerHTML = `Победил ${currentPlayer === 'X' ? '?' : '?'}! ??`;                        return;                    }                }                                if (!board.includes('')) {                    gameOver = true;                    render();                    document.getElementById('tttStatus').textContent = 'Ничья! ??';                    return;                }                                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';                render();            };                        render();        }        async function initMultiplayerTicTacToe(gameId) {            document.getElementById('gameTitle').textContent = '?? Крестики-Нолики (Онлайн)';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;            const mySymbol = isPlayer1 ? 'X' : 'O';                        if (!game.board) {                await db.ref('games/' + gameId + '/board').set(['', '', '', '', '', '', '', '', '']);                await db.ref('games/' + gameId + '/turn').set('X');            }                        function render(board, turn, winner) {                const isMyTurn = turn === mySymbol;                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-4">                        <p class="text-lg text-gray-300">Вы: ${mySymbol === 'X' ? '?' : '?'}</p>                        <p class="text-xl" id="tttStatus">${winner ? (winner === 'draw' ? 'Ничья! ??' : (winner === mySymbol ? 'Вы победили! ??' : 'Вы проиграли ??')) : (isMyTurn ? 'Ваш ход!' : 'Ход противника...')}</p>                    </div>                    <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto">                        ${board.map((cell, i) => `                            <button onclick="multiTttMove(${i})" class="aspect-square glass rounded-xl text-4xl font-bold hover:bg-purple-500/30 transition-all ${cell || !isMyTurn || winner ? 'cursor-not-allowed' : ''}">${cell === 'X' ? '?' : cell === 'O' ? '?' : ''}</button>                        `).join('')}                    </div>                `;            }                        window.multiTttMove = async function(i) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                if (data.board[i] || data.turn !== mySymbol || data.winner) return;                                data.board[i] = mySymbol;                                const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];                let winner = null;                for (const [a,b,c] of wins) {                    if (data.board[a] && data.board[a] === data.board[b] && data.board[a] === data.board[c]) {                        winner = data.board[a];                        break;                    }                }                                if (!winner && !data.board.includes('')) winner = 'draw';                                await db.ref('games/' + gameId).update({                    board: data.board,                    turn: mySymbol === 'X' ? 'O' : 'X',                    winner: winner || null                });            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                const data = snap.val();                if (data && data.board) {                    render(data.board, data.turn, data.winner);                }            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // ROCK PAPER SCISSORS        function initRPS() {            document.getElementById('gameTitle').textContent = '???? Камень-Ножницы-Бумага';            let playerChoice = null;            let computerChoice = null;            let result = null;                        function render() {                document.getElementById('gameContent').innerHTML = `                    <div class="text-center">                        <div class="flex justify-center gap-4 mb-8">                            <button onclick="rpsChoice('rock')" class="text-6xl p-4 glass rounded-2xl hover:bg-purple-500/30 transition-all ${playerChoice === 'rock' ? 'ring-4 ring-purple-500' : ''}">?</button>                            <button onclick="rpsChoice('paper')" class="text-6xl p-4 glass rounded-2xl hover:bg-purple-500/30 transition-all ${playerChoice === 'paper' ? 'ring-4 ring-purple-500' : ''}">?</button>                            <button onclick="rpsChoice('scissors')" class="text-6xl p-4 glass rounded-2xl hover:bg-purple-500/30 transition-all ${playerChoice === 'scissors' ? 'ring-4 ring-purple-500' : ''}">??</button>                        </div>                        ${result ? `                            <div class="mb-6">                                <p class="text-lg mb-2">Компьютер выбрал: ${{'rock':'?','paper':'?','scissors':'??'}[computerChoice]}</p>                                <p class="text-2xl font-bold ${result === 'win' ? 'text-green-400' : result === 'lose' ? 'text-red-400' : 'text-yellow-400'}">${result === 'win' ? 'Вы победили! ??' : result === 'lose' ? 'Вы проиграли ??' : 'Ничья! ??'}</p>                            </div>                        ` : '<p class="text-gray-300 mb-6">Выберите ваш ход</p>'}                        <button onclick="initRPS()" class="btn-primary px-6 py-3 rounded-xl font-bold">?? Играть снова</button>                    </div>                `;            }                        window.rpsChoice = function(choice) {                playerChoice = choice;                const options = ['rock', 'paper', 'scissors'];                computerChoice = options[Math.floor(Math.random() * 3)];                                if (playerChoice === computerChoice) result = 'draw';                else if (                    (playerChoice === 'rock' && computerChoice === 'scissors') ||                    (playerChoice === 'paper' && computerChoice === 'rock') ||                    (playerChoice === 'scissors' && computerChoice === 'paper')                ) result = 'win';                else result = 'lose';                                render();            };                        render();        }        async function initMultiplayerRPS(gameId) {            document.getElementById('gameTitle').textContent = '???? Камень-Ножницы-Бумага (Онлайн)';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        function render(data) {                const myChoice = isPlayer1 ? data.choice1 : data.choice2;                const oppChoice = isPlayer1 ? data.choice2 : data.choice1;                const choiceEmoji = {'rock':'?','paper':'?','scissors':'??'};                                let result = null;                if (data.choice1 && data.choice2) {                    if (myChoice === oppChoice) result = 'draw';                    else if (                        (myChoice === 'rock' && oppChoice === 'scissors') ||                        (myChoice === 'paper' && oppChoice === 'rock') ||                        (myChoice === 'scissors' && oppChoice === 'paper')                    ) result = 'win';                    else result = 'lose';                }                                document.getElementById('gameContent').innerHTML = `                    <div class="text-center">                        ${!myChoice ? `                            <p class="text-xl mb-6">Сделайте ваш выбор!</p>                            <div class="flex justify-center gap-4 mb-8">                                <button onclick="multiRpsChoice('rock')" class="text-6xl p-4 glass rounded-2xl hover:bg-purple-500/30 transition-all">?</button>                                <button onclick="multiRpsChoice('paper')" class="text-6xl p-4 glass rounded-2xl hover:bg-purple-500/30 transition-all">?</button>                                <button onclick="multiRpsChoice('scissors')" class="text-6xl p-4 glass rounded-2xl hover:bg-purple-500/30 transition-all">??</button>                            </div>                        ` : result ? `                            <div class="mb-6">                                <div class="flex justify-center gap-8 mb-4">                                    <div>                                        <p class="text-gray-300 mb-2">Вы</p>                                        <div class="text-6xl">${choiceEmoji[myChoice]}</div>                                    </div>                                    <div class="text-4xl self-center">VS</div>                                    <div>                                        <p class="text-gray-300 mb-2">Противник</p>                                        <div class="text-6xl">${choiceEmoji[oppChoice]}</div>                                    </div>                                </div>                                <p class="text-2xl font-bold ${result === 'win' ? 'text-green-400' : result === 'lose' ? 'text-red-400' : 'text-yellow-400'}">${result === 'win' ? 'Вы победили! ??' : result === 'lose' ? 'Вы проиграли ??' : 'Ничья! ??'}</p>                            </div>                        ` : `                            <div class="text-6xl mb-4 floating">?</div>                            <p class="text-xl">Вы выбрали: ${choiceEmoji[myChoice]}</p>                            <p class="text-gray-300">Ожидание противника...</p>                        `}                    </div>                `;            }                        window.multiRpsChoice = async function(choice) {                const field = isPlayer1 ? 'choice1' : 'choice2';                await db.ref('games/' + gameId + '/' + field).set(choice);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                render(snap.val() || {});            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // MEMORY GAME        function initMemory() {            document.getElementById('gameTitle').textContent = '?? Мемори';            const emojis = ['??', '??', '??', '??', '??', '??', '??', '??'];            let cards = [...emojis, ...emojis].sort(() => Math.random() - 0.5);            let flipped = [];            let matched = [];            let moves = 0;            let startTime = Date.now();                        function render() {                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-4">                        <p class="text-lg">Ходы: ${moves} | Найдено: ${matched.length / 2}/${emojis.length}</p>                    </div>                    <div class="grid grid-cols-4 gap-2 max-w-sm mx-auto">                        ${cards.map((emoji, i) => `                            <div class="memory-card aspect-square cursor-pointer ${flipped.includes(i) || matched.includes(i) ? 'flipped' : ''}" onclick="flipCard(${i})">                                <div class="memory-card-inner w-full h-full relative">                                    <div class="memory-card-front absolute inset-0 glass rounded-xl flex items-center justify-center text-3xl">?</div>                                    <div class="memory-card-back absolute inset-0 glass rounded-xl flex items-center justify-center text-3xl ${matched.includes(i) ? 'bg-green-500/30' : 'bg-purple-500/30'}">${emoji}</div>                                </div>                            </div>                        `).join('')}                    </div>                    ${matched.length === cards.length ? `                        <div class="text-center mt-6">                            <p class="text-2xl font-bold text-green-400 mb-2">Победа! ??</p>                            <p class="text-gray-300">Время: ${Math.round((Date.now() - startTime) / 1000)}с | Ходы: ${moves}</p>                            <button onclick="initMemory()" class="btn-primary px-6 py-3 rounded-xl font-bold mt-4">?? Играть снова</button>                        </div>                    ` : ''}                `;            }                        window.flipCard = function(i) {                if (flipped.length >= 2 || flipped.includes(i) || matched.includes(i)) return;                                flipped.push(i);                render();                                if (flipped.length === 2) {                    moves++;                    const [a, b] = flipped;                    if (cards[a] === cards[b]) {                        matched.push(a, b);                        flipped = [];                        render();                                                if (matched.length === cards.length) {                            const time = Math.round((Date.now() - startTime) / 1000);                            saveScore('memory', 10000 - (time * 10) - (moves * 5));                        }                    } else {                        setTimeout(() => {                            flipped = [];                            render();                        }, 1000);                    }                }            };                        render();        }        // REACTION GAME        function initReaction() {            document.getElementById('gameTitle').textContent = '? Тест реакции';            let state = 'waiting';            let startTime = 0;            let timeout = null;                        function render() {                let content = '';                if (state === 'waiting') {                    content = `                        <div onclick="startReaction()" class="aspect-video glass rounded-2xl flex items-center justify-center cursor-pointer bg-blue-500/30 hover:bg-blue-500/50 transition-all">                            <div class="text-center">                                <div class="text-6xl mb-4">??</div>                                <p class="text-xl">Нажмите, чтобы начать</p>                            </div>                        </div>                    `;                } else if (state === 'ready') {                    content = `                        <div onclick="tooEarly()" class="aspect-video glass rounded-2xl flex items-center justify-center cursor-pointer bg-red-500/30">                            <div class="text-center">                                <div class="text-6xl mb-4">?</div>                                <p class="text-xl">Ждите зелёный цвет...</p>                            </div>                        </div>                    `;                } else if (state === 'go') {                    content = `                        <div onclick="clickReaction()" class="aspect-video glass rounded-2xl flex items-center justify-center cursor-pointer bg-green-500/50 animate-pulse">                            <div class="text-center">                                <div class="text-6xl mb-4">?</div>                                <p class="text-xl font-bold">ЖМИТЕ!</p>                            </div>                        </div>                    `;                } else if (state === 'result') {                    const time = Date.now() - startTime;                    content = `                        <div class="text-center py-8">                            <div class="text-6xl mb-4">?</div>                            <p class="text-4xl font-bold gradient-text mb-2">${time} мс</p>                            <p class="text-gray-300 mb-6">${time < 200 ? 'Невероятно! ??' : time < 300 ? 'Отлично! ??' : time < 400 ? 'Хорошо! ??' : 'Можно лучше! ??'}</p>                            <button onclick="initReaction()" class="btn-primary px-6 py-3 rounded-xl font-bold">?? Ещё раз</button>                        </div>                    `;                    saveScore('reaction', Math.max(0, 1000 - time));                } else if (state === 'early') {                    content = `                        <div class="text-center py-8">                            <div class="text-6xl mb-4">??</div>                            <p class="text-2xl font-bold text-red-400 mb-2">Слишком рано!</p>                            <p class="text-gray-300 mb-6">Дождитесь зелёного цвета</p>                            <button onclick="initReaction()" class="btn-primary px-6 py-3 rounded-xl font-bold">?? Ещё раз</button>                        </div>                    `;                }                document.getElementById('gameContent').innerHTML = content;            }                        window.startReaction = function() {                state = 'ready';                render();                timeout = setTimeout(() => {                    state = 'go';                    startTime = Date.now();                    render();                }, Math.random() * 3000 + 1000);            };                        window.tooEarly = function() {                clearTimeout(timeout);                state = 'early';                render();            };                        window.clickReaction = function() {                state = 'result';                render();            };                        render();        }        // SNAKE GAME        function initSnake() {            document.getElementById('gameTitle').textContent = '?? Змейка';            const size = 15;            let snake = [{x: 7, y: 7}];            let food = {x: 5, y: 5};            let dir = {x: 1, y: 0};            let score = 0;            let gameOver = false;            let interval = null;                        function placeFood() {                do {                    food = {x: Math.floor(Math.random() * size), y: Math.floor(Math.random() * size)};                } while (snake.some(s => s.x === food.x && s.y === food.y));            }                        function render() {                let grid = '';                for (let y = 0; y < size; y++) {                    for (let x = 0; x < size; x++) {                        const isSnake = snake.some(s => s.x === x && s.y === y);                        const isHead = snake[0].x === x && snake[0].y === y;                        const isFood = food.x === x && food.y === y;                        grid += `<div class="aspect-square rounded-sm ${isHead ? 'bg-green-400' : isSnake ? 'bg-green-600' : isFood ? 'bg-red-500' : 'bg-white/10'}"></div>`;                    }                }                                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-4">                        <p class="text-xl font-bold">Счёт: ${score}</p>                    </div>                    <div class="grid gap-0.5 max-w-sm mx-auto" style="grid-template-columns: repeat(${size}, 1fr)">                        ${grid}                    </div>                    ${gameOver ? `                        <div class="text-center mt-6">                            <p class="text-2xl font-bold text-red-400 mb-2">Игра окончена!</p>                            <button onclick="initSnake()" class="btn-primary px-6 py-3 rounded-xl font-bold">?? Играть снова</button>                        </div>                    ` : `                        <div class="flex justify-center gap-2 mt-4">                            <button onclick="snakeDir(0,-1)" class="glass p-3 rounded-xl text-2xl">??</button>                        </div>                        <div class="flex justify-center gap-2 mt-2">                            <button onclick="snakeDir(-1,0)" class="glass p-3 rounded-xl text-2xl">??</button>                            <button onclick="snakeDir(0,1)" class="glass p-3 rounded-xl text-2xl">??</button>                            <button onclick="snakeDir(1,0)" class="glass p-3 rounded-xl text-2xl">??</button>                        </div>                        <p class="text-center text-gray-400 mt-4 text-sm">Или используйте стрелки на клавиатуре</p>                    `}                `;            }                        function move() {                if (gameOver) return;                                const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};                                if (head.x < 0 || head.x >= size || head.y < 0 || head.y >= size || snake.some(s => s.x === head.x && s.y === head.y)) {                    gameOver = true;                    clearInterval(interval);                    saveScore('snake', score);                    render();                    return;                }                                snake.unshift(head);                                if (head.x === food.x && head.y === food.y) {                    score += 10;                    placeFood();                } else {                    snake.pop();                }                                render();            }                        window.snakeDir = function(x, y) {                if ((x !== 0 && dir.x !== 0) || (y !== 0 && dir.y !== 0)) return;                dir = {x, y};            };                        document.onkeydown = (e) => {                if (e.key === 'ArrowUp') snakeDir(0, -1);                if (e.key === 'ArrowDown') snakeDir(0, 1);                if (e.key === 'ArrowLeft') snakeDir(-1, 0);                if (e.key === 'ArrowRight') snakeDir(1, 0);            };                        clearInterval(interval);            interval = setInterval(move, 150);            render();        }        // QUIZ        const quizQuestions = [            {q: "Столица Франции?", a: ["Париж", "Лондон", "Берлин", "Мадрид"], c: 0},            {q: "2 + 2 ? 2 = ?", a: ["6", "8", "4", "10"], c: 0},            {q: "Самая большая планета?", a: ["Юпитер", "Сатурн", "Земля", "Марс"], c: 0},            {q: "Год основания Google?", a: ["1998", "2000", "1995", "2004"], c: 0},            {q: "Сколько континентов?", a: ["7", "6", "5", "8"], c: 0},        ];        function initQuiz() {            document.getElementById('gameTitle').textContent = '?? Викторина';            let current = 0;            let score = 0;            const questions = [...quizQuestions].sort(() => Math.random() - 0.5).slice(0, 5);                        function render() {                if (current >= questions.length) {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-6xl mb-4">??</div>                            <p class="text-3xl font-bold gradient-text mb-2">${score}/${questions.length}</p>                            <p class="text-gray-300 mb-6">${score === questions.length ? 'Идеально! ??' : score >= 3 ? 'Хороший результат! ??' : 'Попробуйте ещё! ??'}</p>                            <button onclick="initQuiz()" class="btn-primary px-6 py-3 rounded-xl font-bold">?? Играть снова</button>                        </div>                    `;                    return;                }                                const q = questions[current];                document.getElementById('gameContent').innerHTML = `                    <div class="text-center mb-6">                        <p class="text-gray-300">Вопрос ${current + 1}/${questions.length}</p>                        <p class="text-2xl font-bold mt-2">${q.q}</p>                    </div>                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">                        ${q.a.map((ans, i) => `                            <button onclick="quizAnswer(${i})" class="glass p-4 rounded-xl text-lg font-bold hover:bg-purple-500/50 transition-all">${ans}</button>                        `).join('')}                    </div>                `;            }                        window.quizAnswer = function(i) {                if (i === questions[current].c) score++;                current++;                render();            };                        render();        }        async function initMultiplayerQuiz(gameId) {            document.getElementById('gameTitle').textContent = '?? Викторина (Онлайн)';                        const gameSnap = await db.ref('games/' + gameId).once('value');            const game = gameSnap.val();            const isPlayer1 = game.player1 === currentUser.uid;                        if (!game.questions) {                const questions = [...quizQuestions].sort(() => Math.random() - 0.5).slice(0, 5);                await db.ref('games/' + gameId + '/questions').set(questions);                await db.ref('games/' + gameId + '/current').set(0);                await db.ref('games/' + gameId + '/score1').set(0);                await db.ref('games/' + gameId + '/score2').set(0);            }                        function render(data) {                if (!data.questions) return;                                const myScore = isPlayer1 ? data.score1 : data.score2;                const oppScore = isPlayer1 ? data.score2 : data.score1;                const myAnswer = isPlayer1 ? data.answer1 : data.answer2;                const oppAnswer = isPlayer1 ? data.answer2 : data.answer1;                                if (data.current >= data.questions.length) {                    document.getElementById('gameContent').innerHTML = `                        <div class="text-center py-8">                            <div class="text-6xl mb-4">??</div>                            <div class="flex justify-center gap-8 mb-4">                                <div>                                    <p class="text-gray-300">Вы</p>                                    <p class="text-3xl font-bold">${myScore}</p>                                </div>                                <div>                                    <p class="text-gray-300">Противник</p>                                    <p class="text-3xl font-bold">${oppScore}</p>                                </div>                            </div>                            <p class="text-2xl font-bold ${myScore > oppScore ? 'text-green-400' : myScore < oppScore ? 'text-red-400' : 'text-yellow-400'}">${myScore > oppScore ? 'Вы победили! ??' : myScore < oppScore ? 'Вы проиграли ??' : 'Ничья! ??'}</p>                        </div>                    `;                    return;                }                                const q = data.questions[data.current];                                if (myAnswer !== undefined && oppAnswer !== undefined) {                    setTimeout(async () => {                        await db.ref('games/' + gameId).update({                            current: data.current + 1,                            answer1: null,                            answer2: null                        });                    }, 1500);                }                                document.getElementById('gameContent').innerHTML = `                    <div class="flex justify-between mb-4">                        <p class="text-lg">Вы: ${myScore}</p>                        <p class="text-lg">Противник: ${oppScore}</p>                    </div>                    <div class="text-center mb-6">                        <p class="text-gray-300">Вопрос ${data.current + 1}/${data.questions.length}</p>                        <p class="text-2xl font-bold mt-2">${q.q}</p>                    </div>                    ${myAnswer !== undefined ? `                        <div class="text-center">                            <p class="text-lg mb-2">Вы ответили: ${q.a[myAnswer]}</p>                            ${oppAnswer !== undefined ? `<p class="text-lg">Противник ответил: ${q.a[oppAnswer]}</p>` : '<p class="text-gray-300">Ожидание противника...</p>'}                        </div>                    ` : `                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">                            ${q.a.map((ans, i) => `                                <button onclick="multiQuizAnswer(${i})" class="glass p-4 rounded-xl text-lg font-bold hover:bg-purple-500/50 transition-all">${ans}</button>                            `).join('')}                        </div>                    `}                `;            }                        window.multiQuizAnswer = async function(i) {                const snap = await db.ref('games/' + gameId).once('value');                const data = snap.val();                const q = data.questions[data.current];                                const answerField = isPlayer1 ? 'answer1' : 'answer2';                const scoreField = isPlayer1 ? 'score1' : 'score2';                const currentScore = isPlayer1 ? data.score1 : data.score2;                                const updates = {};                updates[answerField] = i;                if (i === q.c) updates[scoreField] = currentScore + 1;                                await db.ref('games/' + gameId).update(updates);            };                        const listener = db.ref('games/' + gameId).on('value', (snap) => {                render(snap.val() || {});            });            gameListeners.push({ ref: 'games/' + gameId, callback: listener });        }        // Leaderboard        async function saveScore(game, score) {            if (!currentUser || score <= 0) return;                        const userData = await db.ref('users/' + currentUser.uid).once('value');            const username = userData.val()?.username || 'Игрок';                        const existing = await db.ref('leaderboard/' + game).orderByChild('oderId').equalTo(currentUser.uid).once('value');            const data = existing.val();                        if (data) {                const key = Object.keys(data)[0];                if (data[key].score < score) {                    await db.ref('leaderboard/' + game + '/' + key + '/score').set(score);                }            } else {                await db.ref('leaderboard/' + game).push({                    oderId: currentUser.uid,                    username: username,                    score: score                });            }        }        async function showLeaderboard(game) {            document.querySelectorAll('.lb-btn').forEach(btn => btn.classList.remove('bg-purple-500'));            event.target.classList.add('bg-purple-500');                        const snap = await db.ref('leaderboard/' + game).orderByChild('score').limitToLast(10).once('value');            const data = snap.val() || {};                        const entries = Object.values(data).sort((a, b) => b.score - a.score);                        if (entries.length === 0) {                document.getElementById('leaderboardList').innerHTML = '<p class="text-gray-400 text-center">Пока нет результатов</p>';                return;            }                        const medals = ['??', '??', '??'];            document.getElementById('leaderboardList').innerHTML = entries.map((entry, i) => `                <div class="flex items-center justify-between bg-white/10 rounded-xl p-4 ${entry.oderId === currentUser?.uid ? 'ring-2 ring-purple-500' : ''}">                    <div class="flex items-center gap-3">                        <span class="text-2xl">${medals[i] || (i + 1)}</span>                        <span class="font-bold">${entry.username}</span>                    </div>                    <span class="text-xl font-bold gradient-text">${entry.score}</span>                </div>            `).join('');        }        // Utils        function notify(text) {            const el = document.getElementById('notification');            document.getElementById('notificationText').textContent = text;            el.classList.remove('hidden', 'translate-y-20');            setTimeout(() => {                el.classList.add('translate-y-20');                setTimeout(() => el.classList.add('hidden'), 300);            }, 3000);        }        // Init        showSection('games');    </script></body></html>